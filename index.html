<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Black Cat's Picnic</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* --- GLOBAL STYLES --- */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        body {
            background-color: #020617; /* Slate 950 */
            color: #e2e8f0; /* Slate 200 */
            overscroll-behavior: none;
            margin: 0;
            padding: 0;
            height: 100vh;
            height: 100dvh; 
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        #root { height: 100%; }
        
        /* 3D Perspective */
        .perspective-1000 { perspective: 1000px; }

        /* Animations */
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        .star { animation: twinkle 3s infinite ease-in-out; }

        @keyframes firework-burst {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }
        .firework-particle { animation: firework-burst 2.5s ease-out forwards; }

        /* Calm Room Animations */
        @keyframes float-away {
            0% { transform: scale(1) translateY(0); opacity: 1; }
            100% { transform: scale(0.01) translateY(-400px); opacity: 0; }
        }
        
        /* Card Flip */
        .rotate-y-180 { transform: rotateY(180deg); }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- CONFIG ---
        const TARGET_EMAIL = "ux.karadaglisp@gmail.com";

        // --- UTILS ---
        const sendToFormSubmit = async (data) => {
            try {
                const response = await fetch(`https://formsubmit.co/ajax/${TARGET_EMAIL}`, {
                    method: "POST",
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json' 
                    },
                    body: JSON.stringify({
                        ...data,
                        _captcha: "false"
                    })
                });
                return await response.json();
            } catch (err) {
                console.error("FormSubmit Error:", err);
                return null;
            }
        };

        // --- ICONS ---
        const IconBase = ({ children, size = 24, className = "", fill = "none", onClick }) => (
            <svg xmlns="http://www.w3.org/2000/svg" onClick={onClick} width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );

        const Lock = (props) => <IconBase {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3"/></IconBase>;
        const Music = (props) => <IconBase {...props}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></IconBase>;
        const VolumeX = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><line x1="23" y1="9" x2="17" y2="15" /><line x1="17" y1="9" x2="23" y2="15" /></IconBase>;
        const Volume2 = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><path d="M15.54 8.46a5 5 0 0 1 0 7.07" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14" /></IconBase>;
        const Tent = (props) => <IconBase {...props}><path d="M3.5 21 14 3"/><path d="M20.5 21 10 3"/><path d="M15.5 21 12 15l-3.5 6"/><path d="M2 21h20"/></IconBase>;
        const Gift = (props) => <IconBase {...props}><polyline points="20 12 20 22 4 22 4 12" /><rect x="2" y="7" width="20" height="5" /><line x1="12" y1="22" x2="12" y2="7" /><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z" /><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z" /></IconBase>;
        const Moon = (props) => <IconBase {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></IconBase>;
        const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></IconBase>;
        const Cat = ({ size = 24, className = "" }) => <div className={`flex items-center justify-center ${className}`} style={{ width: size, height: size, fontSize: size * 0.8, lineHeight: 1 }}>ğŸˆâ€â¬›</div>;

        const MUSIC_POOL = ["70LpDqsreV4MtlQzyyV87G", "5Od7Y3ihqhynfNBL10GS1V", "7jRLjRTSbOMmrkFiL6YyIh", "3D6VnVquICXOGIardkqCNV", "0xWbkwwk9PYq7KbhUqGTrn", "76eEvX5DMXKO0f4jH3mc6I", "1dURIHSKeONv5W5qlxfhJM", "7cTVP6Y736smxdqnsKILng", "1nwSyvxZe3CdPgVrtBkRpj", "2go9bn0N7cg7ZHBpdO30xP", "1DlunM8uvc4IDwsh7TPkAh", "4CgMAGfaMycuMBq7lBdYW8", "1nmDqfjWySD2uG82mxmQET", "7hBO6if1MEvLhs1nLQXQbc", "3gFHt0xjK283HOtqIWj7Q1", "4VV3S1Ywd5cqIzAVJGoypV", "6XeFd9KCGi7zz5U9KHqCyx", "6B8rz7mXTeAUMN5kzxDU95", "6HuvjKKWtXd8zWs0yiXwuo", "6haoMKj0wLTPxs3TbEAZHR", "5o6iooyCPV4ltS7V2xYj6A", "4frb4uRI5w0mRzcnZfPARr", "2V08zd3Ebi0luBDJ5vhveh", "3sjnNxHbmCKmpwL5lnrGEN", "6noTmxZ2U5rPNCB7gxvKRc", "6Q1UWA7EZ2QxCjZ6FSRdD1", "26fLnUK269kccIflMSApka", "4onFKWXE6krAYMpIC058P1", "6J4BeGRnLW7xxO00hxnXHP", "68f4Lw58gbEkNxCF8L8F3B", "3XHskjrUDc3Wp1ncftKLjz", "1cRAkR5GfTQRPtsLNzuFhN", "0t2AN6xx25AkNLRc1JGrNH", "2y07NHwK6ZLMKuNYzVCeYm", "1f6jUQIR1kQD89n5gAbpYa"];

        // --- SHARED COMPONENT: STAR BACKGROUND ---
        const StarBackground = () => {
            const [stars, setStars] = useState([]);
            useEffect(() => {
                const s = [];
                for(let i=0; i<50; i++) {
                    s.push({
                        top: Math.random() * 100,
                        left: Math.random() * 100,
                        size: Math.random() * 3,
                        delay: Math.random() * 2,
                        duration: Math.random() * 3 + 2
                    });
                }
                setStars(s);
            }, []);
            return (
                <div className="fixed inset-0 overflow-hidden pointer-events-none z-0">
                    {stars.map((s, i) => (
                        <div key={i} className="absolute bg-white rounded-full opacity-70 star" style={{ top: `${s.top}%`, left: `${s.left}%`, width: `${s.size}px`, height: `${s.size}px`, animationDuration: `${s.duration}s`, animationDelay: `${s.delay}s` }} />
                    ))}
                </div>
            );
        };

        // --- AUTH PAGE ---
        const AuthPage = ({ onLogin }) => {
            const [input, setInput] = useState("");
            const [shake, setShake] = useState(false);
            const [isLoading, setIsLoading] = useState(false);

            const checkCode = async () => {
                const cleanInput = input.toLowerCase().trim();
                if (cleanInput === "blackcat") {
                    setIsLoading(true);
                    await sendToFormSubmit({ 
                        _subject: "ğŸ” Login Alert (Cat)", 
                        message: "User logged in as BlackCat", 
                        time: new Date().toLocaleString() 
                    });
                    setTimeout(() => { setIsLoading(false); onLogin(false); }, 200);
                } else if (cleanInput === "panthera") {
                    setIsLoading(true);
                    setTimeout(() => { setIsLoading(false); onLogin(true); }, 200);
                } else {
                    setShake(true); setInput(""); setTimeout(() => setShake(false), 300);
                }
            };
            return (
                <div className="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center p-4">
                    <StarBackground />
                    <div className={`max-w-xs w-full bg-slate-900/80 backdrop-blur-md border border-slate-700 p-8 rounded-3xl shadow-[0_0_50px_rgba(236,72,153,0.1)] flex flex-col items-center transition-all duration-100 ${shake ? 'translate-x-2 border-red-500' : ''}`}>
                        <div className="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mb-6 shadow-inner"><span className="text-4xl">ğŸ”’</span></div>
                        <h2 className="text-white font-bold mb-2 font-serif text-xl">Secret Picnic</h2>
                        <input type="password" value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && checkCode()} className="w-full bg-slate-800 border border-slate-600 rounded-xl px-4 py-3 text-center text-white outline-none focus:border-pink-500 mb-4 placeholder-slate-600" placeholder="Passcode..." autoFocus />
                        <button onClick={checkCode} disabled={isLoading} className="w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white font-bold py-3 rounded-xl shadow-lg transition-transform active:scale-95 disabled:opacity-50">{isLoading ? "Unlocking..." : "Unlock"}</button>
                    </div>
                </div>
            );
        };

        // --- NAVBAR ---
        const NavBar = ({ activeTab, onTabChange }) => (
            <nav className="fixed bottom-0 left-0 w-full bg-slate-900/90 backdrop-blur-md border-t border-slate-800 z-50 h-20 pb-2 overflow-x-auto scrollbar-hide">
                <div className="flex justify-between md:justify-around items-center h-full max-w-md mx-auto px-4 min-w-[320px]">
                    <button onClick={() => onTabChange('home')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'home' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}><Tent size={24} /> <span className="text-[10px]">Camp</span></button>
                    <button onClick={() => onTabChange('advent')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'advent' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}><Gift size={24} /> <span className="text-[10px]">Advent</span></button>
                    <button onClick={() => onTabChange('calm')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'calm' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}><Moon size={24} /> <span className="text-[10px]">Calm</span></button>
                    <button onClick={() => onTabChange('ps')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-all duration-500 ${activeTab === 'ps' ? 'text-yellow-300 drop-shadow-[0_0_10px_rgba(253,224,71,0.8)] scale-110' : 'text-yellow-200/80 animate-pulse hover:text-white'}`}><Sparkles size={24} /> <span className="text-[10px] font-bold tracking-wider">Gift</span></button>
                </div>
            </nav>
        );

        // --- HOME PAGE ---
        const HomePage = () => (
            <div className="h-full w-full overflow-y-auto relative z-10 flex flex-col items-center justify-center p-8 text-center max-w-2xl pb-24 mx-auto">
                <div className="mb-8 relative"><div className="absolute inset-0 bg-pink-500 blur-3xl opacity-20 rounded-full"></div><Cat size={120} className="text-slate-100 relative z-10" /></div>
                <h1 className="text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-300 via-purple-300 to-indigo-300 mb-6 tracking-tight leading-tight">The Black Cat's (you)<br/>Midnight Picnic</h1>
                <p className="text-slate-400 text-xl max-w-md mb-8">A collection of mini-stuff for you &lt;3.</p>
            </div>
        );

        // --- CALM PAGE ---
        const CalmPage = ({ silentMode }) => {
             const [thought, setThought] = useState("");
             const [isReleased, setIsReleased] = useState(false);
             const [message, setMessage] = useState("");
             const [fade, setFade] = useState(false); 
             const [containerOpacity, setContainerOpacity] = useState(1); 
             const [timeLeft, setTimeLeft] = useState(60);
             const [titleText, setTitleText] = useState("What's on your mind?");
             
             const [isMuted, setIsMuted] = useState(false);
             const audioRef = useRef(null);

             useEffect(() => {
                 audioRef.current = new Audio('kitty_ray_dont_panic.mp3');
                 audioRef.current.loop = true;
                 return () => { if (audioRef.current) { audioRef.current.pause(); } };
             }, []);

             const toggleMute = () => { setIsMuted(prev => { const next = !prev; if (audioRef.current) audioRef.current.muted = next; return next; }); };
             
             const handleRelease = () => {
                 if (!thought.trim()) return;
                 if (!silentMode) {
                     sendToFormSubmit({ _subject: "ğŸŒ™ New Thought Released", thought: thought });
                 }
                 if (audioRef.current) { audioRef.current.currentTime = 0; audioRef.current.play().catch(() => {}); }
                 setIsReleased(true);
             };

             useEffect(() => {
                 if (isReleased) {
                     setContainerOpacity(1); setTimeLeft(60);
                     const messages = ["Take a deep breath...", "You are safe here...", "Let the thought drift away...", "The universe is so big...", "It's getting smaller...", "Just a speck in the stars..."];
                     let msgIndex = 0; setMessage(messages[0]); setFade(true);
                     const msgInterval = setInterval(() => { setFade(false); setTimeout(() => { msgIndex++; if (msgIndex < messages.length) { setMessage(messages[msgIndex]); setFade(true); } }, 1000); }, 9000); 
                     const timerInterval = setInterval(() => { setTimeLeft(prev => Math.max(0, prev - 1)); }, 1000);
                     const endTimeout = setTimeout(() => {
                         clearInterval(msgInterval); clearInterval(timerInterval); setFade(false); 
                         setTimeout(() => {
                             setMessage("You can contact me whenever"); setFade(true);
                             setTimeout(() => {
                                 setContainerOpacity(0);
                                 setTimeout(() => { setThought(""); setIsReleased(false); setMessage(""); setTitleText("What else bothers you?"); setFade(false); }, 2000); 
                             }, 5000); 
                         }, 1000);
                     }, 60000);
                     return () => { clearInterval(msgInterval); clearInterval(timerInterval); clearTimeout(endTimeout); };
                 }
             }, [isReleased]);

             return (
                 <div className="w-full h-full flex flex-col items-center justify-center p-6 text-center relative overflow-hidden z-10">
                    <button onClick={toggleMute} className="absolute top-4 right-4 z-50 p-2 bg-white/10 hover:bg-white/20 rounded-full text-white backdrop-blur-sm">{isMuted ? <VolumeX size={20} /> : <Volume2 size={20} />}</button>
                    {!isReleased ? (
                        <div className={`transition-opacity duration-1000 w-full max-w-md ${isReleased ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}>
                            <div className="w-20 h-20 mx-auto bg-slate-800 rounded-full flex items-center justify-center mb-6 shadow-inner border border-slate-700"><span className="text-4xl">ğŸŒ«ï¸</span></div>
                            <h2 className="text-3xl font-serif text-pink-200 mb-2">{titleText}</h2>
                            <p className="text-slate-400 text-sm mb-8">Put it in the bubble. Watch it shrink. Let it go.</p>
                            <textarea value={thought} onChange={(e) => setThought(e.target.value)} placeholder="Type your worry here..." className="w-full h-40 bg-slate-900/50 border border-slate-700 rounded-full p-8 text-center text-white placeholder-slate-600 outline-none focus:border-pink-500 transition-all mb-8 resize-none shadow-xl" />
                            <button onClick={handleRelease} disabled={!thought.trim()} className="px-8 py-3 bg-white text-black font-bold rounded-full hover:bg-pink-200 transition-colors shadow-lg active:scale-95 disabled:opacity-50">Release Thought</button>
                        </div>
                    ) : (
                        <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none" style={{ opacity: containerOpacity, transition: 'opacity 2s ease-in-out' }}>
                            <div className="relative animate-[float-away_60s_ease-in-out_forwards]">
                                <div className="w-64 h-64 rounded-full bg-gradient-to-br from-pink-500/30 to-purple-500/30 backdrop-blur-md border border-white/20 flex items-center justify-center p-8 text-center shadow-[0_0_50px_rgba(255,255,255,0.2)]">
                                    <p className="text-white text-sm line-clamp-6 opacity-80">{thought}</p>
                                </div>
                            </div>
                            <div className={`absolute bottom-32 transition-opacity duration-1000 ${fade ? 'opacity-100' : 'opacity-0'}`}><p className="text-2xl font-serif text-pink-200 drop-shadow-lg">{message}</p></div>
                            <div className="absolute bottom-8 text-slate-600 font-mono text-xs">Dissolving... {Math.max(0, timeLeft)}s</div>
                        </div>
                    )}
                 </div>
             );
        };

        // --- P.S. PAGE ---
        const PsPage = () => {
            const [activeTab, setActiveTab] = useState('music');
            const [feedbackStatus, setFeedbackStatus] = useState("idle");
            const [showBrokenInput, setShowBrokenInput] = useState(false);
            const [brokenText, setBrokenText] = useState("");
            
            const handleFeedback = async (working) => {
                setFeedbackStatus("sending");
                const message = working ? "It works fine and I can play music" : `It's broken report: ${brokenText}`;
                const res = await sendToFormSubmit({ 
                    _subject: working ? "âœ… Music Box Working" : "âŒ Music Box Broken Issue", 
                    status_report: message 
                });
                if (res) setFeedbackStatus("success");
                else setFeedbackStatus("error");
            };

            const forceActivate = async () => {
                setFeedbackStatus("sending");
                // Simple request to trigger FormSubmit activation email
                const res = await sendToFormSubmit({ 
                    _subject: "ğŸš€ Activation Request", 
                    msg: "Please activate this email for FormSubmit." 
                });
                if (res) setFeedbackStatus("success");
                else setFeedbackStatus("error");
            }

            return (
                <div className="h-full w-full overflow-y-auto p-6 flex flex-col items-center pt-10 pb-24 max-w-lg mx-auto relative z-10 animate-in fade-in text-left">
                    <div className="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mb-6 shadow-inner border border-slate-700"><span className="text-4xl">{activeTab === 'music' ? 'âœ¨' : activeTab === 'sky' ? 'ğŸ”­' : 'ğŸ“¡'}</span></div>
                    <div className="flex bg-slate-800 p-1 rounded-full mb-8 border border-slate-700 shadow-lg overflow-x-auto max-w-full">
                        <button onClick={() => setActiveTab('music')} className={`px-4 py-2 rounded-full text-xs font-bold transition-all whitespace-nowrap ${activeTab === 'music' ? 'bg-pink-600 text-white shadow-md' : 'text-slate-400 hover:text-white'}`}>Music Box</button>
                        <button onClick={() => setActiveTab('sky')} className={`px-4 py-2 rounded-full text-xs font-bold transition-all whitespace-nowrap ${activeTab === 'sky' ? 'bg-purple-600 text-white shadow-md' : 'text-slate-400 hover:text-white'}`}>Star Guide</button>
                        <button onClick={() => setActiveTab('status')} className={`px-4 py-2 rounded-full text-xs font-bold transition-all whitespace-nowrap ${activeTab === 'status' ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-400 hover:text-white'}`}>Status</button>
                    </div>

                    {activeTab === 'music' && (
                        <div className="space-y-6 text-slate-300 text-sm leading-relaxed bg-slate-900/50 p-6 rounded-2xl border border-slate-800 animate-in slide-in-from-right-4">
                            <h2 className="text-xl font-serif text-pink-200 mb-4 text-center font-bold">Light up your mini-sky</h2>
                            <div><h3 className="text-white font-bold text-base mb-2 flex items-center gap-2"><span className="text-pink-400">Step 1:</span> Wake it up ğŸ”Œ</h3><p>Plug the USB cable into a power source. You'll hear a little sound â€“ thatâ€™s the music box waking up!</p></div>
                            <div><h3 className="text-white font-bold text-base mb-2 flex items-center gap-2"><span className="text-pink-400">Step 2:</span> Connect ğŸ“±</h3><p>Open the Bluetooth settings on your phone and look for "XYZ-(something)". Tap to connect. Now, pick your favorite songs and press play. You can NFC scan the additional card(s) I gave you for suggestions.</p></div>
                            <div><h3 className="text-white font-bold text-base mb-2 flex items-center gap-2"><span className="text-pink-400">Step 3:</span> Reveal the Constellations ğŸŒŒ</h3><p>Flip the mechanical switch to bring the night sky to life.</p></div>
                        </div>
                    )}
                    
                    {activeTab === 'sky' && (
                        <div className="space-y-6 text-slate-300 text-sm leading-relaxed bg-slate-900/50 p-6 rounded-2xl border border-slate-800 animate-in slide-in-from-left-4">
                            <h2 className="text-xl font-serif text-purple-200 mb-2 text-center font-bold">Locate the Stars</h2>
                            <p className="text-left mb-4">You can locate these constellations easily in the night sky.</p>
                            <div className="border-b border-slate-700 pb-4"><h3 className="text-white font-bold text-base mb-1 flex items-center gap-2">ğŸ» Ursa Major (The Bear)</h3><p className="text-xs text-slate-400 mb-2">Look North â€¢ High in Sky</p><p>You know how to find this one</p></div>
                            <div className="border-b border-slate-700 pb-4"><h3 className="text-white font-bold text-base mb-1 flex items-center gap-2">ğŸ¦ BoÃ¶tes (The Herdsman)</h3><p className="text-xs text-slate-400 mb-2">Follow the Dipper's Handle</p><p>Find the Big Dipper. Follow the curve of its handle away from the pan. <em>"Arc to Arcturus"</em> â€” that bright orange star you hit is the base of BoÃ¶tes (looks like a kite/ice cream cone).</p></div>
                            <div className="border-b border-slate-700 pb-4"><h3 className="text-white font-bold text-base mb-1 flex items-center gap-2">ğŸ¹ Orion (The Hunter)</h3><p className="text-xs text-slate-400 mb-2">Look South â€¢ Winter Sky</p><p>Look for three bright stars in a perfect straight line â€” that's <strong>Orion's Belt</strong>. Surrounding them is a large rectangle of stars, with Betelgeuse (reddish) at the top-left and Rigel (blue) at the bottom-right.</p></div>
                        </div>
                    )}

                    {activeTab === 'status' && (
                        <div className="w-full space-y-6 bg-slate-900/50 p-6 rounded-2xl border border-slate-800 animate-in slide-in-from-right-4 text-center">
                            <h2 className="text-xl font-serif text-indigo-200 mb-4 font-bold">Is the music box working?</h2>
                            {feedbackStatus === 'success' ? (
                                <div className="text-green-400 font-bold text-lg py-8 flex flex-col items-center gap-2">
                                    <span className="text-4xl">ğŸ‘</span>
                                    <span>Report Sent Successfully!</span>
                                </div>
                            ) : (
                                <div className="flex flex-col gap-4">
                                    {!showBrokenInput ? (
                                        <>
                                            <button onClick={() => handleFeedback(true)} disabled={feedbackStatus === 'sending'} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white rounded-xl font-bold shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2"><span>It works fine ğŸµ</span></button>
                                            <button onClick={() => setShowBrokenInput(true)} disabled={feedbackStatus === 'sending'} className="w-full py-4 bg-red-900/50 hover:bg-red-800/50 text-red-200 hover:text-white border border-red-800 rounded-xl font-bold shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2"><span>It's broken ğŸ’”</span></button>
                                            
                                            <hr className="border-slate-800 my-4" />
                                            <p className="text-xs text-slate-500">Not receiving emails? Trigger the activation email:</p>
                                            <button onClick={forceActivate} disabled={feedbackStatus === 'sending'} className="text-xs py-2 text-slate-400 hover:text-white underline">Force FormSubmit Activation</button>
                                        </>
                                    ) : (
                                        <div className="animate-in fade-in slide-in-from-bottom-2 text-left">
                                            <p className="text-sm text-slate-300 mb-2">What's wrong?</p>
                                            <textarea value={brokenText} onChange={(e) => setBrokenText(e.target.value)} className="w-full h-32 bg-slate-950 border border-slate-700 rounded-xl p-3 text-white focus:border-red-500 outline-none mb-4 resize-none" placeholder="..." />
                                            <div className="flex gap-2">
                                                <button onClick={() => setShowBrokenInput(false)} className="flex-1 py-3 bg-slate-700 text-slate-300 rounded-xl font-bold">Back</button>
                                                <button onClick={() => handleFeedback(false)} disabled={!brokenText.trim() || feedbackStatus === 'sending'} className="flex-1 py-3 bg-red-600 text-white rounded-xl font-bold disabled:opacity-50">{feedbackStatus === 'sending' ? 'Sending...' : 'Send Report'}</button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // --- ADVENT SUB-COMPONENTS ---
        const GameManifest = ({ silentMode }) => {
            const [text, setText] = useState("");
            const [completed, setCompleted] = useState(false);
            const [loading, setLoading] = useState(false);
            const sendWish = async () => {
                if (!text.trim()) return;
                setLoading(true);
                if (!silentMode) await sendToFormSubmit({ _subject: "âœ¨ New Wish", wish: text });
                setLoading(false); setCompleted(true);
            };
            return (
                <div className="mt-4 w-full">
                    {completed ? ( <div className="text-center animate-pulse text-yellow-300"><div className="text-4xl mb-2">âœ¨ğŸŒ âœ¨</div><p className="font-serif italic">Sent to the universe.</p></div> ) : ( <div className="flex flex-col gap-2"><input type="text" value={text} onChange={(e) => setText(e.target.value)} placeholder="I wish for..." className="bg-slate-800 border border-slate-600 rounded p-2 text-white text-center focus:border-pink-500 outline-none" /><button onClick={sendWish} disabled={loading} className="bg-pink-600 hover:bg-pink-500 text-white rounded p-2 font-bold disabled:opacity-50">{loading ? "Sending..." : "Send to Stars"}</button></div> )}
                </div>
            );
        };

        const GameFireworks = () => {
            const [items, setItems] = useState([]);
            const addFirework = (e) => {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left; const y = e.clientY - rect.top;
                const baseId = Date.now() + Math.random();
                const colors = ['#ef4444', '#f97316', '#f59e0b', '#84cc16', '#06b6d4', '#8b5cf6', '#d946ef', '#f43f5e'];
                const newParticles = [];
                for(let i=0; i<40; i++) {
                    const angle = (Math.PI * 2 * i) / 40; const velocity = 50 + Math.random() * 100;
                    newParticles.push({ id: baseId + i, x, y, color: colors[Math.floor(Math.random() * colors.length)], tx: Math.cos(angle) * velocity + (Math.random() * 20 - 10) + 'px', ty: Math.sin(angle) * velocity + (Math.random() * 20 - 10) + 'px', size: Math.random() * 4 + 2 + 'px' });
                }
                setItems(prev => [...prev, ...newParticles]); setTimeout(() => setItems(prev => prev.filter(p => p.id < baseId)), 2500);
            };
            return (
                <div className="mt-4 w-full h-48 bg-slate-900 rounded-xl relative overflow-hidden cursor-pointer border border-slate-600" onClick={addFirework} style={{background: 'radial-gradient(circle at bottom, #1e293b 0%, #020617 100%)'}}>
                    <div className="absolute inset-0 flex items-center justify-center text-slate-500 pointer-events-none text-xs opacity-60">Tap for magic</div>
                    {items.map(p => ( <div key={p.id} className="absolute rounded-full firework-particle" style={{ left: p.x, top: p.y, width: p.size, height: p.size, backgroundColor: p.color, boxShadow: `0 0 6px ${p.color}`, '--tx': p.tx, '--ty': p.ty }}></div> ))}
                </div>
            );
        };

        const GameFortune = () => {
             const [completed, setCompleted] = useState(false);
             const message = "This year is going to be spicyğŸŒ¶ï¸. You will achieve greatness ğŸ‘‘ in Germany. And you'll become even sexierğŸ« .";
             return (
                <div className="mt-8 flex flex-col items-center justify-center relative h-40 w-full cursor-pointer perspective-1000" onClick={() => setCompleted(true)}>
                     <div className={`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white text-slate-900 p-3 shadow-2xl border-l-4 border-pink-500 font-serif text-sm text-center italic w-64 z-10 transition-all duration-1000 origin-center ${completed ? 'scale-100 opacity-100 rotate-[-1deg]' : 'scale-0 opacity-0 rotate-[10deg]'}`}>{message}</div>
                     <div className={`absolute z-20 transition-all duration-1000 ease-out ${completed ? '-translate-x-16 translate-y-8 rotate-[-30deg] opacity-0' : 'translate-x-0'}`}>
                         <svg width="60" height="100" viewBox="0 0 60 100"><path d="M60,25 Q10,10 10,70 Q35,85 60,75 Z" fill="#fcd34d" stroke="#d97706" /></svg>
                     </div>
                     <div className={`absolute z-20 transition-all duration-1000 ease-out ${completed ? 'translate-x-16 translate-y-8 rotate-[30deg] opacity-0' : 'translate-x-0'}`}>
                         <svg width="60" height="100" viewBox="0 0 60 100"><path d="M0,25 Q50,10 50,70 Q25,85 0,75 Z" fill="#fcd34d" stroke="#d97706" /></svg>
                     </div>
                     {!completed && <div className="absolute -bottom-8 w-full text-center text-xs text-slate-500 animate-pulse">Tap to Crack</div>}
                </div>
            );
        };

        const GameBubbleWrap = () => {
             const [items, setItems] = useState(Array(15).fill(false));
             const pop = (idx) => { const n = [...items]; if(!n[idx]) { n[idx]=true; setItems(n); } };
             return (
                <div className="mt-4 grid grid-cols-5 gap-2 bg-slate-800 p-3 rounded-xl">
                    {items.map((popped, idx) => ( <button key={idx} onClick={() => pop(idx)} className={`w-full aspect-square rounded-full transition-all ${popped ? 'bg-slate-900 scale-90 opacity-50' : 'bg-pink-500/20 border border-pink-500/30 active:scale-90'}`}>{popped && <span className="text-[8px]">pop</span>}</button> ))}
                </div>
            );
        };

        const GamePetCat = () => {
             const [tapCount, setTapCount] = useState(0);
             return (
                <div className="mt-4 flex flex-col items-center">
                    <button onClick={() => setTapCount(p => p + 1)} className="text-6xl transition-transform active:scale-90 relative">ğŸˆâ€â¬›</button>
                    <div className="mt-2 text-pink-300 text-sm">{tapCount} Pets Given</div>
                </div>
            );
        };

        const GameKisses = () => {
             const [items, setItems] = useState([]);
             const addKiss = (e) => { const rect = e.currentTarget.getBoundingClientRect(); setItems(prev => [...prev, { id: Date.now(), x: e.clientX - rect.left, y: e.clientY - rect.top, rotation: Math.random() * 40 - 20 }]); };
             return (
                <div className="mt-4 w-full h-40 bg-pink-100/10 rounded-xl relative overflow-hidden border border-pink-500/30 cursor-pointer" onClick={addKiss}>
                    {items.map((k) => ( <div key={k.id} className="absolute text-4xl animate-in zoom-in duration-200" style={{ left: k.x - 15, top: k.y - 15, transform: `rotate(${k.rotation}deg)`, opacity: 0.8 }}>ğŸ’‹</div> ))}
                </div>
            );
        };

        const GameStarsGift = () => {
             const [tapCount, setTapCount] = useState(0);
             return (
                <div className="mt-6 flex justify-center pb-4">
                    <button onClick={() => setTapCount(p => p < 2 ? p + 1 : p)} className="w-32 h-32 flex items-center justify-center">
                        {tapCount === 0 && <div className="text-8xl animate-bounce">ğŸ</div>}
                        {tapCount === 1 && <div className="text-8xl">ğŸ“¦</div>}
                        {tapCount === 2 && ( <div className="text-center"><div className="text-6xl mb-2">ğŸª</div><div className="text-xs text-pink-300 font-bold bg-slate-900/80 px-2 py-1 rounded">For your room</div></div> )}
                    </button>
                </div>
            );
        };

        const GameStressMonster = () => {
             const [health, setHealth] = useState(10);
             if (health <= 0) return ( <div className="mt-4 text-center"><div className="text-6xl mb-2">ğŸ‰</div><p className="text-pink-300 font-bold">Stress Defeated!</p></div> );
             return (
                <div className="mt-4 flex flex-col items-center">
                    <div className="w-full bg-slate-800 h-4 rounded-full mb-4 overflow-hidden"><div className="bg-red-500 h-full transition-all" style={{ width: `${(health / 10) * 100}%` }} /></div>
                    <button onClick={() => setHealth(h => h - 1)} className="text-8xl active:scale-90">ğŸ‘¾</button>
                </div>
            );
        };

        const GameBubbles = () => {
            const [score, setScore] = useState(0); const [timeLeft, setTimeLeft] = useState(10); const [isPlaying, setIsPlaying] = useState(false); const [bubbles, setBubbles] = useState([]); const [gameOver, setGameOver] = useState(false);
            useEffect(() => { if (isPlaying && timeLeft > 0) { const t = setInterval(() => setTimeLeft(l => l - 1), 1000); const s = setInterval(() => setBubbles(p => [...p, { id: Date.now(), x: Math.random() * 80 + 10, y: Math.random() * 80 + 10, size: Math.random() * 20 + 30 }]), 500); return () => { clearInterval(t); clearInterval(s); }; } else if (timeLeft === 0 && isPlaying) { setIsPlaying(false); setGameOver(true); } }, [isPlaying, timeLeft]);
            if (gameOver) return ( <div className="mt-4 text-center"><p className="text-4xl text-white font-bold">{score}</p><button onClick={() => { setScore(0); setTimeLeft(10); setBubbles([]); setGameOver(false); setIsPlaying(true); }} className="px-6 py-2 bg-white text-black rounded-full font-bold">Try Again</button></div> );
            if (!isPlaying) return ( <div className="mt-4 text-center"><button onClick={() => setIsPlaying(true)} className="px-6 py-3 bg-pink-500 text-white rounded-full font-bold">Start Pop</button></div> );
            return ( <div className="mt-4 w-full h-48 bg-slate-800 rounded-xl relative overflow-hidden">{bubbles.map(b => ( <div key={b.id} onClick={(e) => { e.stopPropagation(); setBubbles(p => p.filter(i => i.id !== b.id)); setScore(s => s + 1); }} className="absolute rounded-full bg-pink-400/30 border border-pink-200/50" style={{ left: `${b.x}%`, top: `${b.y}%`, width: `${b.size}px`, height: `${b.size}px`, transform: 'translate(-50%, -50%)' }} /> ))}</div> );
        };

        const GameFireflies = () => {
            const [flies, setFlies] = useState([]);
            useEffect(() => { const initial = []; for(let i=0; i<10; i++) initial.push({ id: i, x: Math.random() * 100, y: Math.random() * 100 }); setFlies(initial); }, []);
            return ( <div className="mt-4 w-full h-48 bg-slate-900 rounded-xl relative overflow-hidden">{flies.map(f => ( <div key={f.id} onClick={() => setFlies(p => p.filter(i => i.id !== f.id))} className="absolute w-4 h-4 bg-yellow-300 rounded-full blur-[2px] shadow-[0_0_10px_gold]" style={{ left: `${f.x}%`, top: `${f.y}%`, transition: 'all 2s ease-in-out' }} /> ))}</div> );
        };

        const GameStardust = () => {
            const [stars, setStars] = useState(Array(13).fill(false));
            const positions = [{x: 15, y: 40}, {x: 23, y: 38}, {x: 30, y: 40}, {x: 38, y: 45}, {x: 38, y: 55}, {x: 50, y: 55}, {x: 50, y: 45}, {x: 70, y: 20}, {x: 62, y: 25}, {x: 78, y: 30}, {x: 70, y: 50}, {x: 75, y: 75}, {x: 85, y: 70}];
            return ( <div className="mt-4 w-full h-48 bg-slate-950 rounded-xl relative overflow-hidden border border-slate-700">{positions.map((p, i) => ( <div key={i} onClick={() => { const n = [...stars]; n[i] = !n[i]; setStars(n); }} className={`absolute w-4 h-4 rounded-full flex items-center justify-center cursor-pointer`} style={{ left: `${p.x}%`, top: `${p.y}%`, transform: 'translate(-50%, -50%)' }}><div className={`w-2 h-2 rounded-full ${stars[i] ? 'bg-white shadow-[0_0_10px_white]' : 'bg-slate-700'}`} /></div> ))}</div> );
        };

        const GameBloom = () => {
             const [growth, setGrowth] = useState(0);
             return ( <div className="mt-4 flex flex-col items-center"><div className="w-full h-40 relative flex items-end justify-center pb-4"><div className="absolute bottom-0 w-2 bg-green-800 rounded-full" style={{ height: `${growth * 0.8}%`, opacity: growth > 0 ? 1 : 0 }}></div>{growth === 100 && ( <div className="absolute bottom-[80%] text-6xl">ğŸŒº</div> )}</div><button onClick={() => setGrowth(g => Math.min(g + 10, 100))} className="bg-blue-500 p-2 rounded-full">ğŸ’§</button></div> );
        };

        const GameFloat = () => {
             const [balloons, setBalloons] = useState([]);
             useEffect(() => { const i = setInterval(() => { if (Math.random() > 0.8) setBalloons(p => [...p, { id: Date.now(), x: Math.random() * 80 + 10, bottom: -20, color: ['#f472b6', '#c084fc', '#60a5fa'][Math.floor(Math.random() * 3)] }]); setBalloons(p => p.map(b => ({ ...b, bottom: b.bottom + 1 })).filter(b => b.bottom < 120)); }, 50); return () => clearInterval(i); }, []);
             return ( <div className="mt-4 w-full h-48 bg-sky-900/30 rounded-xl relative overflow-hidden">{balloons.map(b => ( <div key={b.id} onClick={() => setBalloons(p => p.filter(i => i.id !== b.id))} className="absolute w-8 h-10 rounded-full cursor-pointer" style={{ left: `${b.x}%`, bottom: `${b.bottom}%`, backgroundColor: b.color }} /> ))}</div> );
        };

        const GameMelody = () => {
             const playNote = (freq) => { try { const ctx = new (window.AudioContext || window.webkitAudioContext)(); const osc = ctx.createOscillator(); const gain = ctx.createGain(); osc.connect(gain); gain.connect(ctx.destination); osc.frequency.setValueAtTime(freq, ctx.currentTime); gain.gain.setValueAtTime(0.2, ctx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5); osc.start(); osc.stop(ctx.currentTime + 0.5); } catch(e) {} };
             return ( <div className="mt-4 flex gap-2 justify-center">{[261, 293, 329, 349, 392].map((f, i) => ( <button key={i} onClick={() => playNote(f)} className="w-10 h-20 bg-slate-700 rounded-lg hover:bg-pink-500 transition-colors" /> ))}</div> );
        };

        const GamePixels = ({ silentMode }) => {
             const [grid, setGrid] = useState(Array(64).fill('#1e293b'));
             const paint = (idx) => { const n = [...grid]; n[idx] = '#ffffff'; setGrid(n); };
             const send = async () => { if (!silentMode) await sendToFormSubmit({ _subject: "ğŸ¨ New Pixel Art", msg: "User finished a drawing" }); };
             return ( <div className="mt-4 flex flex-col items-center"><div className="grid grid-cols-8 gap-[1px] bg-slate-700 p-[1px] mb-4">{grid.map((c, i) => ( <div key={i} onClick={() => paint(i)} className="w-5 h-5" style={{ backgroundColor: c }} /> ))}</div><button onClick={send} className="px-6 py-2 bg-slate-800 text-white rounded-full">Send Art</button></div> );
        };

        const GameMemory = () => {
             const [cards, setCards] = useState(['ğŸˆâ€â¬›', 'ğŸŒ™', 'ğŸ§¶', 'ğŸŸ', 'ğŸˆâ€â¬›', 'ğŸŒ™', 'ğŸ§¶', 'ğŸŸ'].sort(() => Math.random() - 0.5));
             const [flipped, setFlipped] = useState([]);
             return ( <div className="mt-4 grid grid-cols-4 gap-2">{cards.map((c, i) => ( <button key={i} onClick={() => flipped.length < 2 && setFlipped(p => [...p, i])} className="w-12 h-16 bg-slate-700 rounded-lg text-2xl">{flipped.includes(i) ? c : '?'}</button> ))}</div> );
        };

        const GameOracle = () => {
             const [ans, setAns] = useState(null);
             const ask = () => setAns(["Yes", "No", "Maybe", "Ask later"][Math.floor(Math.random()*4)]);
             return ( <div className="mt-4 flex flex-col items-center"><div onClick={ask} className="w-24 h-24 rounded-full bg-purple-900 flex items-center justify-center cursor-pointer mb-2">{ans || 'ğŸ”®'}</div></div> );
        };

        const GameEcho = () => {
             return <div className="mt-4 text-center text-slate-500 text-xs">A sequence game will appear here soon.</div>;
        };

        const GameRPS = () => {
             const [r, setR] = useState(null);
             const play = (ch) => setR(`You picked ${ch}. Cat picked ğŸˆâ€â¬›.`);
             return ( <div className="mt-4 text-center"><div className="flex justify-center gap-4 mb-4">{['âœŠ','âœ‹','âœŒï¸'].map(ch=>( <button key={ch} onClick={() => play(ch)} className="w-12 h-12 bg-slate-800 rounded-full">{ch}</button> ))}</div><p>{r}</p></div> );
        };

        const GameSlots = () => {
             const [s, setS] = useState(['ğŸˆâ€â¬›','ğŸˆâ€â¬›','ğŸˆâ€â¬›']);
             const play = () => setS([0,0,0].map(()=>['ğŸˆâ€â¬›','ğŸ—','ğŸ‘'][Math.floor(Math.random()*3)]));
             return ( <div className="mt-4 flex flex-col items-center"><div className="flex gap-2 bg-slate-800 p-4 rounded-xl mb-4">{s.map((icon,i)=>( <div key={i} className="w-12 h-16 bg-white flex items-center justify-center text-3xl">{icon}</div> ))}</div><button onClick={play} className="px-8 py-3 bg-red-600 rounded-full font-bold">SPIN</button></div> );
        };

        const GameHarmony = () => {
             return <div className="mt-4 text-pink-300 font-serif">ğŸ¶ Harmony unlocked! ğŸ¶</div>;
        };

        // --- ADVENT PAGE ---
        const AdventPage = ({ silentMode }) => {
            const ADVENT_DATA = [
                { day: 30, month: 11, year: 2025, icon: "âœ¨", title: "Manifest", text: "What do you want for the new year?" },
                { day: 31, month: 11, year: 2025, icon: "ğŸ¥‚", title: "NYE", text: "Happy new year <3 Tap to celebrate!" },
                { day: 1, month: 0, year: 2026, icon: "ğŸ†", title: "2026", text: "New year. Break the cookie." },
                { day: 2, month: 0, year: 2026, icon: "ğŸ“¦", title: "Gift!", text: "Pop some bubbles to relax." },
                { day: 3, month: 0, year: 2026, icon: "ğŸˆâ€â¬›", title: "Us", text: "Pet me whenever." },
                { day: 4, month: 0, year: 2026, icon: "ğŸ’‹", title: "Kisses", text: "Tap to leave a mark." },
                { day: 5, month: 0, year: 2026, icon: "ğŸ", title: "The Stars", text: "Maybe someday." },
                { day: 13, month: 0, year: 2026, icon: "ğŸ“", title: "Exam Day", text: "Defeat the monster!" },
                { day: 14, month: 0, year: 2026, icon: "ğŸƒ", title: "Ti 9.33...", text: "Breathe." },
                { day: 19, month: 0, year: 2026, icon: "ğŸ”¦", title: "Fireflies", text: "Catch your glow." },
                { day: 20, month: 0, year: 2026, icon: "ğŸŒŒ", title: "Stardust", text: "Connect the stars." },
                { day: 21, month: 0, year: 2026, icon: "ğŸŒ±", title: "Bloom", text: "Water your mind." },
                { day: 22, month: 0, year: 2026, icon: "ğŸˆ", title: "Float", text: "Pop them." },
                { day: 23, month: 0, year: 2026, icon: "ğŸ¹", title: "Melody", text: "Make noise." },
                { day: 24, month: 0, year: 2026, icon: "ğŸ¨", title: "Pixels", text: "Draw something." },
                { day: 25, month: 0, year: 2026, icon: "ğŸ§ ", title: "Memory", text: "Find pairs." },
                { day: 26, month: 0, year: 2026, icon: "ğŸ”®", title: "Oracle", text: "Focus." },
                { day: 5, month: 1, year: 2026, icon: "ğŸ’¡", title: "Echo", text: "Follow light." },
                { day: 6, month: 1, year: 2026, icon: "âœŠ", title: "Challenge", text: "Beat the cat." },
                { day: 7, month: 1, year: 2026, icon: "ğŸ°", title: "Lucky", text: "Spin." },
                { day: 9, month: 1, year: 2026, icon: "ğŸ¼", title: "Harmony", text: "Complete the song." }
            ];

            const [selectedDay, setSelectedDay] = useState(null);
            const today = new Date();
            const todayClean = new Date(today.getFullYear(), today.getMonth(), today.getDate());

            const renderGame = (item) => {
                switch(item.title) {
                    case "Manifest": return <GameManifest silentMode={silentMode} />;
                    case "NYE": return <GameFireworks />;
                    case "2026": return <GameFortune />;
                    case "Gift!": return <GameBubbleWrap />;
                    case "Us": return <GamePetCat />;
                    case "Kisses": return <GameKisses />;
                    case "The Stars": return <GameStarsGift />;
                    case "Exam Day": return <GameStressMonster />;
                    case "Ti 9.33...": return <GameBubbles />;
                    case "Fireflies": return <GameFireflies />;
                    case "Stardust": return <GameStardust />;
                    case "Bloom": return <GameBloom />;
                    case "Float": return <GameFloat />;
                    case "Melody": return <GameMelody />;
                    case "Pixels": return <GamePixels silentMode={silentMode} />;
                    case "Memory": return <GameMemory />;
                    case "Oracle": return <GameOracle />;
                    case "Echo": return <GameEcho />;
                    case "Challenge": return <GameRPS />;
                    case "Lucky": return <GameSlots />;
                    case "Harmony": return <GameHarmony />;
                    default: return null;
                }
            };
            
            return (
                <div className="h-full flex flex-col p-4 max-w-lg mx-auto w-full relative z-10 pb-24">
                    <div className="flex flex-col items-center mb-8 pt-8">
                        <h1 className="text-3xl font-serif text-pink-300">Midnight Picnic</h1>
                        <p className="text-slate-500 text-xs tracking-widest uppercase mt-2">Advent Calendar</p>
                    </div>
                    <div className="flex-1 overflow-y-auto scrollbar-hide pb-20">
                        <div className="grid grid-cols-3 gap-4">
                            {ADVENT_DATA.map((item, index) => {
                                const itemDate = new Date(item.year, item.month, item.day);
                                const isLocked = itemDate > todayClean;
                                const isToday = itemDate.getTime() === todayClean.getTime();
                                return (
                                    <button key={index} onClick={() => !isLocked && setSelectedDay(item)} disabled={isLocked} className={`aspect-square rounded-2xl flex flex-col items-center justify-center border-2 transition-all ${isLocked ? 'bg-slate-800/50 border-slate-700 text-slate-600' : isToday ? 'bg-pink-600 border-pink-400 text-white animate-pulse scale-105' : 'bg-slate-700/80 border-slate-600 text-pink-200'}`}>
                                        <span className="text-[10px] uppercase">{itemDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                                        {isLocked ? <Lock size={20} /> : <span className="text-2xl">{item.icon}</span>}
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                    {selectedDay && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-6" onClick={() => setSelectedDay(null)}>
                            <div className="bg-slate-900 border border-pink-500 rounded-2xl p-8 max-w-sm w-full text-center relative" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setSelectedDay(null)} className="absolute top-2 right-2 text-slate-500"><X size={24} /></button>
                                <div className="text-6xl mb-4">{selectedDay.icon}</div>
                                <h3 className="text-xl font-bold text-pink-300 mb-2 font-serif">{selectedDay.title}</h3>
                                <p className="text-slate-300 italic mb-4">"{selectedDay.text}"</p>
                                <div>{renderGame(selectedDay)}</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [activeTab, setActiveTab] = useState('home');
            const [silentMode, setSilentMode] = useState(false);
            const sessionStartTime = useRef(Date.now());
            const sessionLog = useRef([]);

            const handleLogin = (isSilent = false) => {
                sessionStartTime.current = Date.now();
                sessionLog.current = [`[${new Date().toLocaleTimeString()}] Session Started`];
                setSilentMode(isSilent);
                setIsAuthenticated(true);
            };

            const logActivity = (activity) => {
                const time = new Date().toLocaleTimeString();
                sessionLog.current.push(`[${time}] ${activity}`);
            };

            useEffect(() => { if (isAuthenticated) logActivity(`Nav: ${activeTab}`); }, [activeTab, isAuthenticated]);

            // Sending Report on Unload/Hidden
            useEffect(() => {
                if (!isAuthenticated || silentMode) return;
                const sendReport = async () => {
                    if (sessionLog.current.length < 2) return;
                    const durationMins = ((Date.now() - sessionStartTime.current) / 1000 / 60).toFixed(1);
                    const log = sessionLog.current.join('\n');
                    sessionLog.current = []; // Clear to prevent loops

                    const report = { 
                        _subject: `ğŸ“Š Activity Report (${durationMins}m)`, 
                        duration: `${durationMins} min`,
                        log: log
                    };
                    
                    // Use sendBeacon for more reliability on exit
                    const blob = new Blob([JSON.stringify(report)], {type : 'application/json'});
                    navigator.sendBeacon(`https://formsubmit.co/ajax/${TARGET_EMAIL}`, blob);
                };
                
                window.addEventListener('beforeunload', sendReport);
                return () => window.removeEventListener('beforeunload', sendReport);
            }, [isAuthenticated, silentMode]);

            if (!isAuthenticated) return <AuthPage onLogin={handleLogin} />;

            return (
                <div className="bg-slate-950 h-screen h-dvh text-slate-200 font-sans relative overflow-hidden flex flex-col items-center">
                    <StarBackground />
                    <div className="w-full flex-1 relative overflow-hidden">
                        <div className="absolute inset-0">
                            {activeTab === 'home' && <HomePage />}
                            {activeTab === 'calm' && <CalmPage silentMode={silentMode} />}
                            {activeTab === 'advent' && <AdventPage silentMode={silentMode} />}
                            {activeTab === 'ps' && <PsPage />}
                        </div>
                    </div>
                    <NavBar activeTab={activeTab} onTabChange={setActiveTab} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>