<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Black Cat's Picnic</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* --- GLOBAL STYLES --- */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        body {
            background-color: #020617; /* Slate 950 */
            color: #e2e8f0; /* Slate 200 */
            overscroll-behavior: none;
            margin: 0;
            padding: 0;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height for mobile */
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        #root { height: 100%; }
        
        /* 3D Perspective for Advent Fortune Cookie */
        .perspective-1000 { perspective: 1000px; }

        /* Animations */
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        .star { animation: twinkle 3s infinite ease-in-out; }

        @keyframes firework-burst {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }
        .firework-particle { animation: firework-burst 2.5s ease-out forwards; }

        /* Calm Room Animations */
        @keyframes float-away {
            0% { transform: scale(1) translateY(0); opacity: 1; }
            100% { transform: scale(0.01) translateY(-400px); opacity: 0; }
        }

        /* Breathing Animation */
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.5); opacity: 1; }
        }
        .breathing-circle { animation: breathe 8s infinite ease-in-out; }
        
        /* Card Flip */
        .rotate-y-180 { transform: rotateY(180deg); }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const IconBase = ({ children, size = 24, className = "", fill = "none", onClick }) => (
            <svg xmlns="http://www.w3.org/2000/svg" onClick={onClick} width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );

        // UI Icons
        const Lock = (props) => <IconBase {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3"/></IconBase>;
        const Pause = (props) => <IconBase {...props}><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></IconBase>;
        const RefreshCw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const Music = (props) => <IconBase {...props}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></IconBase>;
        const VolumeX = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><line x1="23" y1="9" x2="17" y2="15" /><line x1="17" y1="9" x2="23" y2="15" /></IconBase>;
        const Volume2 = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><path d="M15.54 8.46a5 5 0 0 1 0 7.07" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14" /></IconBase>;
        
        // Navigation Icons
        const Tent = (props) => <IconBase {...props}><path d="M3.5 21 14 3"/><path d="M20.5 21 10 3"/><path d="M15.5 21 12 15l-3.5 6"/><path d="M2 21h20"/></IconBase>;
        const Book = (props) => <IconBase {...props}><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></IconBase>;
        const Star = (props) => <IconBase {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></IconBase>;
        const Heart = (props) => <IconBase {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></IconBase>;
        const Gift = (props) => <IconBase {...props}><polyline points="20 12 20 22 4 22 4 12" /><rect x="2" y="7" width="20" height="5" /><line x1="12" y1="22" x2="12" y2="7" /><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z" /><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z" /></IconBase>;
        const Moon = (props) => <IconBase {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></IconBase>;
        const PenTool = (props) => <IconBase {...props}><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></IconBase>;

        // Custom Cat Icon Component
        const Cat = ({ size = 24, className = "" }) => <div className={`flex items-center justify-center ${className}`} style={{ width: size, height: size, fontSize: size * 0.8, lineHeight: 1 }}>üêà‚Äç‚¨õ</div>;

        // --- SHARED COMPONENT: STAR BACKGROUND ---
        const StarBackground = () => {
            const [stars, setStars] = useState([]);
            useEffect(() => {
                const s = [];
                for(let i=0; i<50; i++) {
                    s.push({
                        top: Math.random() * 100,
                        left: Math.random() * 100,
                        size: Math.random() * 3,
                        delay: Math.random() * 2,
                        duration: Math.random() * 3 + 2
                    });
                }
                setStars(s);
            }, []);

            return (
                <div className="fixed inset-0 overflow-hidden pointer-events-none z-0">
                    {stars.map((s, i) => (
                        <div key={i} className="absolute bg-white rounded-full opacity-70 star" style={{ top: `${s.top}%`, left: `${s.left}%`, width: `${s.size}px`, height: `${s.size}px`, animationDuration: `${s.duration}s`, animationDelay: `${s.delay}s` }} />
                    ))}
                </div>
            );
        };

        // --- PAGE: AUTH ---
        const AuthPage = ({ onLogin }) => {
            const [input, setInput] = useState("");
            const [shake, setShake] = useState(false);
            const [isLoading, setIsLoading] = useState(false);

            const checkCode = () => {
                const cleanInput = input.toLowerCase().trim();
                
                if (cleanInput === "blackcat") {
                    setIsLoading(true);
                    
                    // Send notification email
                    (async () => {
                        try {
                            await fetch("https://formsubmit.co/ajax/karadaglisp@gmail.com", {
                                method: "POST",
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json'
                                },
                                body: JSON.stringify({
                                    _subject: "üîê Login Alert: Midnight Picnic Accessed",
                                    message: "The correct password 'blackcat' was entered.",
                                    timestamp: new Date().toLocaleString(),
                                    _captcha: "false" 
                                })
                            });
                        } catch (err) {}
                    })();

                    setTimeout(() => {
                        setIsLoading(false);
                        onLogin(false); // false = NOT silent mode
                    }, 200);
                    
                } else if (cleanInput === "panthera") {
                    // Admin/Silent Login
                    setIsLoading(true);
                    setTimeout(() => {
                        setIsLoading(false);
                        onLogin(true); // true = SILENT mode
                    }, 200);
                } else {
                    setShake(true);
                    setInput("");
                    setTimeout(() => setShake(false), 300);
                }
            };

            return (
                <div className="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center p-4">
                    <StarBackground />
                    <div className={`max-w-xs w-full bg-slate-900/80 backdrop-blur-md border border-slate-700 p-8 rounded-3xl shadow-[0_0_50px_rgba(236,72,153,0.1)] flex flex-col items-center transition-all duration-100 ${shake ? 'translate-x-2 border-red-500' : ''}`}>
                        <div className="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mb-6 shadow-inner">
                            <span className="text-4xl">üîí</span>
                        </div>
                        <h2 className="text-white font-bold mb-2 font-serif text-xl">Secret Picnic</h2>
                        <p className="text-slate-400 text-xs mb-6 text-center">Enter the passcode to enter your secret lair</p>
                        
                        <input 
                            type="password" 
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && checkCode()}
                            className="w-full bg-slate-800 border border-slate-600 rounded-xl px-4 py-3 text-center text-white outline-none focus:border-pink-500 focus:ring-1 focus:ring-pink-500 mb-4 transition-all placeholder-slate-600"
                            placeholder="Passcode..."
                            autoFocus
                        />
                        
                        <button 
                            onClick={checkCode}
                            disabled={isLoading}
                            className="w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white font-bold py-3 rounded-xl shadow-lg transition-transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            {isLoading ? "Unlocking..." : "Unlock"}
                        </button>
                    </div>
                </div>
            );
        };

        // --- COMPONENT: NAVBAR ---
        const NavBar = ({ activeTab, onTabChange }) => (
            <nav className="fixed bottom-0 left-0 w-full bg-slate-900/90 backdrop-blur-md border-t border-slate-800 z-50 h-20 pb-2 overflow-x-auto scrollbar-hide">
                <div className="flex justify-between md:justify-around items-center h-full max-w-md mx-auto px-4 min-w-[320px]">
                    <button onClick={() => onTabChange('home')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'home' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}>
                        <Tent size={24} /> <span className="text-[10px]">Camp</span>
                    </button>
                    <button onClick={() => onTabChange('advent')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'advent' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}>
                        <Gift size={24} /> <span className="text-[10px]">Advent</span>
                    </button>
                    <button onClick={() => onTabChange('study')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'study' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}>
                        <Book size={24} /> <span className="text-[10px]">Study</span>
                    </button>
                    <button onClick={() => onTabChange('calm')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'calm' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}>
                        <Moon size={24} /> <span className="text-[10px]">Calm</span>
                    </button>
                    <button onClick={() => onTabChange('stars')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'stars' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}>
                        <Star size={24} /> <span className="text-[10px]">Stars</span>
                    </button>
                    <button onClick={() => onTabChange('feedback')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'feedback' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}>
                        <PenTool size={24} /> <span className="text-[10px]">Ideas</span>
                    </button>
                    <button onClick={() => onTabChange('msg')} className={`flex flex-col items-center gap-1 p-2 min-w-[3rem] transition-colors ${activeTab === 'msg' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'}`}>
                        <Heart size={24} /> <span className="text-[10px]">Msg</span>
                    </button>
                </div>
            </nav>
        );

        // --- PAGE: HOME ---
        const HomePage = ({ onNavigate }) => (
            <div className="h-full w-full overflow-y-auto relative z-10 flex flex-col items-center justify-center p-8 text-center max-w-2xl pb-24 mx-auto">
                <div className="mb-8 relative">
                    <div className="absolute inset-0 bg-pink-500 blur-3xl opacity-20 rounded-full"></div>
                    <Cat size={120} className="text-slate-100 relative z-10" />
                </div>
                <h1 className="text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-300 via-purple-300 to-indigo-300 mb-6 tracking-tight leading-tight">
                    The Black Cat's (you)<br/>Midnight Picnic
                </h1>
                <p className="text-slate-400 text-xl max-w-md mb-8">
                    A collection of mini-stuff for you &lt;3.
                </p>
                <button 
                    onClick={() => onNavigate('stars')} 
                    className="px-8 py-3 bg-white text-black font-bold rounded-full hover:bg-pink-200 transition-colors flex items-center gap-2 cursor-pointer shadow-lg active:scale-95 transform duration-150"
                >
                    <Play size={16} /> Enter World
                </button>
            </div>
        );

        // --- PAGE: STUDY ---
        const DECORATION_ITEMS = ['‚òï', 'üïØÔ∏è', 'ü™¥', 'üìö', 'üß∏', 'üéß', 'üß∂', 'üåµ', 'üîÆ', 'üñºÔ∏è', 'üêà‚Äç‚¨õ', 'üçë', 'üåô', '‚ú®', 'üßÅ', 'üçì', 'üéÄ', 'üéπ', 'üéª', 'üé∑', 'üé®', 'üöÄ', 'üõ∏', 'ü™ê', 'üè∞', 'üé°', 'üß∏', 'ü•ê', 'ü•û', 'üíê', 'üç´', 'üç©', 'üç™', 'üç¨', 'üç≠', 'üçÆ', 'üçØ', 'üçº', 'ü•õ', 'üßÉ', 'üßâ', 'üßä'];

        const StargazerLily = ({ progress }) => {
            const scale = 0.2 + (progress / 100) * 0.8;
            const opacity = 0.5 + (progress / 100) * 0.5;
            return (
                <div className="relative w-48 h-48 flex items-center justify-center transition-all duration-1000 ease-out mb-6" style={{ transform: `scale(${scale})`, opacity: opacity }}>
                   <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-[0_0_15px_rgba(236,72,153,0.6)]">
                       <g fill="#ec4899" stroke="#be185d" strokeWidth="1"> <path d="M50 50 Q30 80 50 100 Q70 80 50 50" /> <path d="M50 50 Q30 20 50 0 Q70 20 50 50" /> <path d="M50 50 Q80 30 100 50 Q80 70 50 50" /> <path d="M50 50 Q20 30 0 50 Q20 70 50 50" /> <path d="M50 50 Q20 20 15 15 Q40 10 50 50" transform="rotate(45 50 50)" /> <path d="M50 50 Q80 80 85 85 Q60 90 50 50" transform="rotate(45 50 50)" /> </g>
                       <g fill="#be185d"> <circle cx="50" cy="40" r="1.5" /> <circle cx="50" cy="30" r="1.5" /> <circle cx="60" cy="50" r="1.5" /> <circle cx="70" cy="50" r="1.5" /> <circle cx="40" cy="50" r="1.5" /> <circle cx="30" cy="50" r="1.5" /> <circle cx="50" cy="60" r="1.5" /> <circle cx="50" cy="70" r="1.5" /> </g>
                       <circle cx="50" cy="50" r="6" fill="#facc15" stroke="#a16207" /> <path d="M50 50 L40 40 M50 50 L60 40 M50 50 L40 60 M50 50 L60 60" stroke="#facc15" strokeWidth="2" strokeLinecap="round" />
                   </svg>
                </div>
            )
        }

        const StudyPage = () => {
            const [timeLeft, setTimeLeft] = useState(25 * 60);
            const [isActive, setIsActive] = useState(false);
            const [mode, setMode] = useState('focus'); 
            const [cycle, setCycle] = useState(0);
            const [decorations, setDecorations] = useState([]);
            const [activeDrag, setActiveDrag] = useState(null); 
            const [flowerProgress, setFlowerProgress] = useState(0);
            const [modalMessage, setModalMessage] = useState(null); 
            const [focusTime, setFocusTime] = useState(25);
            const [breakTime, setBreakTime] = useState(5);
            const [isEditing, setIsEditing] = useState(false);
            const containerRef = useRef(null);

            useEffect(() => { const saved = localStorage.getItem('cat_decorations'); if (saved) setDecorations(JSON.parse(saved)); }, []);
            useEffect(() => { localStorage.setItem('cat_decorations', JSON.stringify(decorations)); }, [decorations]);

            useEffect(() => {
                let interval = null;
                if (isActive && timeLeft > 0) {
                    interval = setInterval(() => {
                        setTimeLeft(t => t - 1);
                        if (mode === 'focus') { setFlowerProgress(((focusTime * 60 - (timeLeft - 1)) / (focusTime * 60)) * 100); }
                    }, 1000);
                } else if (timeLeft === 0 && isActive) {
                    setIsActive(false);
                    if (mode === 'focus') {
                        setCycle(c => c + 1);
                        setDecorations(prev => [...prev, { id: Date.now(), content: DECORATION_ITEMS[Math.floor(Math.random() * DECORATION_ITEMS.length)], x: 20 + Math.random() * 60, y: 20 + Math.random() * 60 }, { id: Date.now() + 1, type: 'lily', content: 'lily', x: 50 + (Math.random() * 20 - 10), y: 50 + (Math.random() * 20 - 10) }]);
                        setModalMessage({ title: "Good job, kitten!", text: "You did amazing! üñ§ Here is a treat for you. Take a well-deserved break.", button: "Start Break", nextMode: "break" });
                        setFlowerProgress(100); 
                    } else {
                        setModalMessage({ title: "Break's Over!", text: "Ready to conquer the world again? Keep going! üí™", button: "Start Focus", nextMode: "focus" });
                        setFlowerProgress(0);
                    }
                }
                return () => clearInterval(interval);
            }, [isActive, timeLeft, mode, focusTime]);

            const toggleTimer = () => setIsActive(!isActive);
            const resetTimer = () => { setIsActive(false); setTimeLeft(mode === 'focus' ? focusTime * 60 : breakTime * 60); if (mode === 'focus') setFlowerProgress(0); };
            const switchMode = (newMode) => { setMode(newMode); setIsActive(false); setTimeLeft(newMode === 'focus' ? focusTime * 60 : breakTime * 60); if (newMode === 'focus') setFlowerProgress(0); };
            const updateTimes = (newFocus, newBreak) => { const f = parseInt(newFocus) || 25; const b = parseInt(newBreak) || 5; setFocusTime(f); setBreakTime(b); if (!isActive) { setTimeLeft(mode === 'focus' ? f * 60 : b * 60); } };
            const quickSet = (f, b) => { updateTimes(f, b); if (!isActive) { setTimeLeft(mode === 'focus' ? f * 60 : b * 60); } }
            const handlePointerDown = (e, id) => { e.preventDefault(); setActiveDrag({ id }); };
            const onContainerMove = (e) => { if (!activeDrag || !containerRef.current) return; e.preventDefault(); const rect = containerRef.current.getBoundingClientRect(); const clientX = e.touches ? e.touches[0].clientX : e.clientX; const clientY = e.touches ? e.touches[0].clientY : e.clientY; const xPct = ((clientX - rect.left) / rect.width) * 100; const yPct = ((clientY - rect.top) / rect.height) * 100; setDecorations(prev => prev.map(d => d.id === activeDrag.id ? { ...d, x: Math.min(95, Math.max(5, xPct)), y: Math.min(95, Math.max(5, yPct)) } : d )); };
            const onContainerUp = () => { setActiveDrag(null); };
            const formatTime = (seconds) => { const mins = Math.floor(seconds / 60); const secs = seconds % 60; return `${mins}:${secs < 10 ? '0' : ''}${secs}`; };
            const handleModalClose = () => { if (modalMessage.nextMode) { switchMode(modalMessage.nextMode); } setModalMessage(null); }

            return (
                <div className="h-full w-full flex flex-col relative z-10 pb-20 pt-4" onMouseMove={onContainerMove} onTouchMove={onContainerMove} onMouseUp={onContainerUp} onTouchEnd={onContainerUp} ref={containerRef}>
                    {modalMessage && ( <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in px-4"> <div className="bg-slate-800 border-2 border-pink-500 rounded-xl p-6 max-w-sm w-full text-center shadow-2xl"> <h3 className="text-2xl font-bold text-pink-400 mb-2">{modalMessage.title}</h3> <p className="text-slate-300 mb-6">{modalMessage.text}</p> <button onClick={handleModalClose} className="px-6 py-3 bg-pink-600 hover:bg-pink-500 text-white rounded-full font-bold transition-all transform hover:scale-105"> {modalMessage.button} </button> </div> </div> )}
                    <div className="p-2 text-center z-10 flex flex-col items-center w-full">
                        {isEditing && ( <div className="bg-slate-800/90 p-4 rounded-xl mb-4 border border-slate-700 w-full max-w-xs animate-in slide-in-from-top-2"> <div className="flex gap-2 mb-4 justify-center"> <div className="flex flex-col"> <label className="text-xs text-slate-400 mb-1">Focus (min)</label> <input type="number" value={focusTime} onChange={(e) => updateTimes(e.target.value, breakTime)} className="bg-slate-900 border border-slate-600 rounded p-2 w-20 text-center text-white" /> </div> <div className="flex flex-col"> <label className="text-xs text-slate-400 mb-1">Break (min)</label> <input type="number" value={breakTime} onChange={(e) => updateTimes(focusTime, e.target.value)} className="bg-slate-900 border border-slate-600 rounded p-2 w-20 text-center text-white" /> </div> </div> <div className="flex gap-2 justify-center text-xs"> <button onClick={() => quickSet(25, 5)} className="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded">25/5</button> <button onClick={() => quickSet(50, 10)} className="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded">50/10</button> <button onClick={() => quickSet(60, 15)} className="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded">60/15</button> </div> </div> )}
                        <div className="flex justify-center gap-2 mb-4"> <button onClick={() => switchMode('focus')} className={`px-4 py-1 rounded-full text-sm font-bold transition-colors ${mode === 'focus' ? 'bg-pink-600 text-white' : 'bg-slate-800 text-slate-400'}`}>Focus</button> <button onClick={() => switchMode('break')} className={`px-4 py-1 rounded-full text-sm font-bold transition-colors ${mode === 'break' ? 'bg-green-600 text-white' : 'bg-slate-800 text-slate-400'}`}>Break</button> </div>
                        {mode === 'focus' && !isEditing && <StargazerLily progress={flowerProgress} />}
                        <div className="text-5xl font-mono font-bold text-white mb-4 tracking-wider drop-shadow-lg"> {formatTime(timeLeft)} </div>
                        <div className="flex justify-center gap-4"> <button onClick={toggleTimer} className="w-14 h-14 bg-white text-black rounded-full flex items-center justify-center hover:bg-pink-100 transition-colors shadow-lg"> {isActive ? <Pause /> : <Play />} </button> <button onClick={resetTimer} className="w-14 h-14 bg-slate-800 text-slate-300 rounded-full flex items-center justify-center hover:bg-slate-700 transition-colors shadow-lg"> <RefreshCw /> </button> </div>
                        <div className="mt-2 text-xs text-slate-500"> Sessions Completed: {cycle} </div>
                    </div>
                    <div className="flex-1 relative bg-slate-800/50 m-4 rounded-xl border-2 border-slate-700 shadow-inner overflow-hidden max-w-2xl w-full mx-auto mb-20">
                        <div className="absolute inset-0 pointer-events-none opacity-10 flex items-center justify-center text-8xl"> üìö </div>
                        <div className="absolute bottom-2 left-0 right-0 text-center text-xs text-slate-500 pointer-events-none"> Drag items to decorate your space </div>
                        {decorations.map(deco => ( <div key={deco.id} className="absolute text-3xl cursor-grab active:cursor-grabbing hover:scale-125 transition-transform select-none" style={{ left: `${deco.x}%`, top: `${deco.y}%`, transform: 'translate(-50%, -50%)' }} onMouseDown={(e) => handlePointerDown(e, deco.id)} onTouchStart={(e) => handlePointerDown(e, deco.id)}> {deco.type === 'lily' ? ( <div style={{ width: '60px', height: '60px' }}> <StargazerLily progress={100} /> </div> ) : ( deco.content )} </div> ))}
                    </div>
                </div>
            );
        };

        // --- PAGE: STARS ---
        const ConstellationIllustration = ({ title, icon, data }) => {
            const hasRealData = !!data;
            const seed = title.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            const random = (offset = 0) => { const x = Math.sin(seed + offset) * 10000; return x - Math.floor(x); };
            let stars = [], lines = [];
            
            if (hasRealData) { 
                if (data.s && data.l) {
                    stars = data.s.map(d => ({ x: d[0], y: d[1], size: d[2] || 3 }));
                    lines = data.l.map(d => ({ 
                        x1: stars[d[0]].x, y1: stars[d[0]].y, 
                        x2: stars[d[1]].x, y2: stars[d[1]].y 
                    }));
                } else {
                    stars = data.stars; lines = data.lines; 
                }
            } else { 
                const starCount = 5 + Math.floor(random(1) * 5); 
                for(let i=0; i<starCount; i++) stars.push({ x: 15 + random(i * 2) * 70, y: 15 + random(i * 2 + 1) * 70, size: 2 + random(i * 3) * 2 }); 
                const sortedStars = [...stars].sort((a,b) => a.x - b.x); 
                for(let i=0; i<sortedStars.length-1; i++) lines.push({ x1: sortedStars[i].x, y1: sortedStars[i].y, x2: sortedStars[i+1].x, y2: sortedStars[i+1].y }); 
                stars = sortedStars; 
            }
            return (
                <div className="w-full h-64 bg-slate-950 rounded-2xl relative overflow-hidden mb-6 border-2 border-slate-700 shadow-inner group">
                    <div className="absolute inset-0 opacity-40 transition-opacity duration-1000" style={{ background: `radial-gradient(circle at ${random(10)*100}% ${random(11)*100}%, rgba(147, 51, 234, 0.3), transparent 60%), radial-gradient(circle at ${random(12)*100}% ${random(13)*100}%, rgba(236, 72, 153, 0.2), transparent 50%)` }} />
                    <div className="absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none select-none grayscale contrast-150 transform scale-150 group-hover:scale-125 transition-transform duration-1000"> <span className="text-9xl filter blur-sm">{icon}</span> </div>
                    <svg className="w-full h-full absolute inset-0 p-4 pointer-events-none"> {lines.map((line, i) => ( <line key={i} x1={`${line.x1}%`} y1={`${line.y1}%`} x2={`${line.x2}%`} y2={`${line.y2}%`} stroke="rgba(255,255,255,0.4)" strokeWidth="1.5" strokeDasharray="5,5" className="animate-pulse" style={{ animationDuration: '3s' }} /> ))} {stars.map((s, i) => ( <circle key={i} cx={`${s.x}%`} cy={`${s.y}%`} r={s.size || (3 + random(i)*2)} fill="white" className="drop-shadow-[0_0_4px_rgba(255,255,255,0.8)]"> <animate attributeName="opacity" values="0.5;1;0.5" dur={`${2 + random(i)}s`} repeatCount="indefinite" /> </circle> ))} </svg>
                    <div className="absolute bottom-2 right-4 text-xs text-slate-500 font-mono opacity-50"> {hasRealData ? "ASTRONOMICAL DATA" : `ARTISTIC REP. FIG. ${seed % 100}`} </div>
                </div>
            )
        }

        const StarsPage = () => {
            const [activeConstellation, setActiveConstellation] = useState(null);
            const [currentTracks, setCurrentTracks] = useState([]);
            const [currentConstellations, setCurrentConstellations] = useState([]);
            
            const MUSIC_POOL = ["70LpDqsreV4MtlQzyyV87G", "5Od7Y3ihqhynfNBL10GS1V", "0xWbkwwk9PYq7KbhUqGTrn"]; 
            const CONSTELLATIONS_DB = [
                { id: 'and', icon: 'üë∏', title: 'Andromeda', text: 'The Chained Princess.', visibility: { season: 'Autumn', time: '9 PM' }, data: { s: [[80,20], [65,35], [50,50], [35,65], [35,35]], l: [[0,1], [1,2], [2,3]] } },
                { id: 'ori', icon: 'üèπ', title: 'Orion', text: 'The Hunter.', visibility: { season: 'Winter', time: '9 PM' }, data: { s: [[25,20], [75,25], [45,50], [50,50], [55,50], [30,80], [70,85]], l: [[0,2], [1,4], [2,3], [3,4], [2,5], [4,6]] } },
                { id: 'cas', icon: 'üëë', title: 'Cassiopeia', text: 'The Queen.', visibility: { season: 'Autumn', time: '9 PM' }, data: { s: [[10,30], [30,60], [50,40], [70,60], [90,30]], l: [[0,1], [1,2], [2,3], [3,4]] } }
            ];

            const shuffleTracks = () => { const shuffled = [...MUSIC_POOL].sort(() => 0.5 - Math.random()); setCurrentTracks(shuffled.slice(0, 4)); };
            const shuffleConstellations = () => { const shuffled = [...CONSTELLATIONS_DB].sort(() => 0.5 - Math.random()); setCurrentConstellations(shuffled.slice(0, 4)); };
            useEffect(() => { shuffleTracks(); shuffleConstellations(); }, []);
            
            return ( 
                <div className="p-6 max-w-2xl mx-auto min-h-screen flex flex-col justify-center pb-24 relative z-10"> 
                    <h2 className="text-3xl font-serif text-center text-pink-200 mb-8 border-b border-slate-700 pb-4"> You as a Constellation </h2> 
                    <div className="bg-slate-800/50 rounded-xl p-4 mb-8 border border-slate-700 backdrop-blur-sm relative overflow-hidden group"> 
                        <div className="absolute top-0 right-0 p-2 opacity-50 group-hover:opacity-100 transition-opacity z-10"> 
                            <button onClick={shuffleTracks} className="p-2 bg-black/40 hover:bg-pink-500 rounded-full transition-colors" title="Shuffle Songs"> <RefreshCw size={16} className="text-white" /> </button> 
                        </div> 
                        <div className="flex items-center gap-4 mb-4"> 
                            <div className="w-16 h-16 bg-gradient-to-br from-pink-500 to-purple-900 rounded-lg flex items-center justify-center animate-pulse"> <Music className="text-white w-8 h-8" /> </div> 
                            <div> <h3 className="text-white font-bold">Midnight Mixtape</h3> <p className="text-pink-400 text-sm">Music I listen to when I'm thinking of you</p> </div> 
                        </div> 
                        <div className="space-y-3"> {currentTracks.map((trackId, i) => ( <iframe key={i} style={{ borderRadius: '12px' }} src={`https://open.spotify.com/embed/track/${trackId}?utm_source=generator&theme=0`} width="100%" height="80" frameBorder="0" allowFullScreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy" className="bg-slate-900" /> ))} </div> 
                    </div> 
                    <div className="flex justify-between items-center mb-4 px-2"> <h3 className="text-pink-200 font-bold text-lg">Star Map</h3> <button onClick={shuffleConstellations} className="p-2 bg-slate-800 hover:bg-pink-600/50 rounded-full transition-colors flex items-center gap-2 text-xs text-slate-400 hover:text-white"> <RefreshCw size={14} /> Shuffle Stars </button> </div> 
                    <div className="grid grid-cols-2 gap-4 mb-8"> {currentConstellations.map((c) => ( <button key={c.id} onClick={() => setActiveConstellation(c)} className="p-4 bg-slate-800/80 rounded-xl border border-slate-700 hover:border-pink-500/50 transition-all hover:scale-105 text-left group"> <div className="text-3xl mb-2 group-hover:animate-bounce shadow-white drop-shadow-md">{c.icon}</div> <h3 className="text-pink-200 font-bold text-sm">{c.title}</h3> </button> ))} </div> 
                    {activeConstellation && ( <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4" onClick={() => setActiveConstellation(null)}> <div className="bg-slate-900 border border-pink-500 rounded-2xl p-6 max-w-sm w-full relative transform scale-100 transition-transform flex flex-col items-center" onClick={e => e.stopPropagation()}> <button onClick={() => setActiveConstellation(null)} className="absolute top-2 right-2 text-slate-500 hover:text-white z-10"><X size={20}/></button> <ConstellationIllustration title={activeConstellation.title} icon={activeConstellation.icon} data={activeConstellation.data} /> <h3 className="text-2xl font-serif font-bold text-pink-400 mb-2 text-center">{activeConstellation.title}</h3> <p className="text-slate-300 text-center leading-relaxed text-sm mb-2">{activeConstellation.text}</p> {activeConstellation.visibility && <p className="text-pink-400 text-xs text-center font-mono mb-4">{activeConstellation.visibility.season} ‚Ä¢ {activeConstellation.visibility.time}</p>} <div className="mt-2 text-center text-xs text-slate-600">Tap anywhere to close</div> </div> </div> )} 
                </div> 
            );
        };

        // --- PAGE: CALM (Thought Shrinker) ---
        const CalmPage = ({ silentMode }) => {
             const [thought, setThought] = useState("");
             const [isReleased, setIsReleased] = useState(false);
             const [message, setMessage] = useState("");
             const [fade, setFade] = useState(false); 
             const [containerOpacity, setContainerOpacity] = useState(1); 
             const [timeLeft, setTimeLeft] = useState(60);
             const [titleText, setTitleText] = useState("What's on your mind?");
             const [isGriefMode, setIsGriefMode] = useState(false);
             
             const [isMuted, setIsMuted] = useState(false);
             const audioRef = useRef(null);

             useEffect(() => {
                 // Initialize Audio
                 audioRef.current = new Audio('kitty_ray_dont_panic.mp3');
                 audioRef.current.loop = true;
                 
                 return () => {
                     if (audioRef.current) {
                         audioRef.current.pause();
                         audioRef.current.currentTime = 0;
                     }
                 };
             }, []);

             const toggleMute = () => {
                 setIsMuted(prev => {
                    const next = !prev;
                    if (audioRef.current) {
                        audioRef.current.muted = next;
                    }
                    return next;
                 });
             };
             
             const handleRelease = () => {
                 if (!thought.trim()) return;
                 
                 // Send email via FormSubmit ONLY if not silent
                 if (!silentMode) {
                     fetch("https://formsubmit.co/ajax/karadaglisp@gmail.com", {
                        method: "POST",
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            _subject: "üåô New Thought Released",
                            thought: thought,
                            timestamp: new Date().toLocaleString(),
                            _captcha: "false"
                        })
                     }).catch(err => console.error("Failed to send thought:", err));
                 }

                 // Play song
                 if (audioRef.current) {
                     audioRef.current.currentTime = 0; // Restart song from beginning
                     audioRef.current.play().catch(e => console.log("Audio play prevented:", e));
                 }
                 
                 setIsReleased(true);
             };

             useEffect(() => {
                 if (isReleased) {
                     setContainerOpacity(1); 
                     setTimeLeft(60);
                     
                     const griefKeywords = ["autn", "nopi", "aunt", "miss her", "death", "relative", "loss", "grief", "die"];
                     const isGrief = griefKeywords.some(keyword => thought.toLowerCase().includes(keyword));
                     setIsGriefMode(isGrief);

                     const normalMessages = [
                         "Take a deep breath...",
                         "You are safe here...",
                         "Let the thought drift away...",
                         "The universe is so big...",
                         "It's getting smaller...",
                         "Just a speck in the stars..."
                     ];

                     const griefMessages = [
                         "This love is real...",
                         "She is part of the stars now...",
                         "It's okay to miss her...",
                         "You carry her light...",
                         "Breathe through the memory...",
                         "Love never fades..."
                     ];
                     
                     const messages = isGrief ? griefMessages : normalMessages;
                     
                     let msgIndex = 0;
                     setMessage(messages[0]); 
                     setFade(true);

                     const msgInterval = setInterval(() => {
                         setFade(false); 
                         setTimeout(() => {
                             msgIndex++;
                             if (msgIndex < messages.length) {
                                 setMessage(messages[msgIndex]);
                                 setFade(true); 
                             }
                         }, 1000); 
                     }, 9000); 

                     const timerInterval = setInterval(() => {
                         setTimeLeft(prev => {
                             if (prev <= 1) return 0;
                             return prev - 1;
                         });
                     }, 1000);

                     const endTimeout = setTimeout(() => {
                         clearInterval(msgInterval);
                         clearInterval(timerInterval);
                         setFade(false); 
                         
                         setTimeout(() => {
                             setMessage(isGrief ? "She is always with you." : "You can contact me whenever");
                             setFade(true);
                             
                             setTimeout(() => {
                                 setContainerOpacity(0);
                                 
                                 setTimeout(() => {
                                     // Reset State
                                     setThought("");
                                     setIsReleased(false);
                                     setMessage("");
                                     setTitleText("What else bothers you?");
                                     setIsGriefMode(false);
                                     setFade(false);
                                 }, 2000); 
                             }, 5000); 
                         }, 1000);
                     }, 60000);

                     return () => {
                         clearInterval(msgInterval);
                         clearInterval(timerInterval);
                         clearTimeout(endTimeout);
                     };
                 }
             }, [isReleased]);

             return (
                 <div className="w-full h-full flex flex-col items-center justify-center p-6 text-center relative overflow-hidden z-10">
                    <button 
                        onClick={toggleMute}
                        className="absolute top-4 right-4 z-50 p-2 bg-white/10 hover:bg-white/20 rounded-full transition-colors text-white backdrop-blur-sm"
                        title={isMuted ? "Unmute" : "Mute"}
                    >
                        {isMuted ? <VolumeX size={20} /> : <Volume2 size={20} />}
                    </button>

                    {!isReleased ? (
                        <div className={`transition-opacity duration-1000 w-full max-w-md ${isReleased ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}>
                            <div className="w-20 h-20 mx-auto bg-slate-800 rounded-full flex items-center justify-center mb-6 shadow-inner border border-slate-700">
                                <span className="text-4xl">üå´Ô∏è</span>
                            </div>
                            <h2 className="text-3xl font-serif text-pink-200 mb-2">{titleText}</h2>
                            <p className="text-slate-400 text-sm mb-8">Put it in the bubble. Watch it shrink. Let it go.</p>
                            
                            <textarea
                                value={thought}
                                onChange={(e) => setThought(e.target.value)}
                                placeholder="Type your worry here..."
                                className="w-full h-40 bg-slate-900/50 border border-slate-700 rounded-full p-8 text-center text-white placeholder-slate-600 outline-none focus:border-pink-500 focus:ring-1 focus:ring-pink-500 transition-all mb-8 resize-none shadow-xl"
                            />
                            
                            <button
                                onClick={handleRelease}
                                disabled={!thought.trim()}
                                className="px-8 py-3 bg-white text-black font-bold rounded-full hover:bg-pink-200 transition-colors shadow-lg active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                Release Thought
                            </button>
                        </div>
                    ) : (
                        <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none" style={{ opacity: containerOpacity, transition: 'opacity 2s ease-in-out' }}>
                            <div className="relative animate-[float-away_60s_ease-in-out_forwards]">
                                <div className="w-64 h-64 rounded-full bg-gradient-to-br from-pink-500/30 to-purple-500/30 backdrop-blur-md border border-white/20 flex items-center justify-center p-8 text-center shadow-[0_0_50px_rgba(255,255,255,0.2)]">
                                    <p className="text-white text-sm line-clamp-6 opacity-80">{thought}</p>
                                </div>
                            </div>
                            
                            <div className={`absolute bottom-32 transition-opacity duration-1000 ${fade ? 'opacity-100' : 'opacity-0'}`}>
                                <p className="text-2xl font-serif text-pink-200 drop-shadow-lg">{message}</p>
                            </div>

                            <div className="absolute bottom-8 text-slate-600 font-mono text-xs">
                                Dissolving... {Math.max(0, timeLeft)}s
                            </div>
                        </div>
                    )}
                 </div>
             );
        };

        // --- PAGE: FEEDBACK / IDEAS ---
        const FeedbackPage = ({ silentMode }) => {
            const [type, setType] = useState("feature");
            const [text, setText] = useState("");
            const [status, setStatus] = useState("idle"); // idle, sending, success, error

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!text.trim()) return;

                setStatus("sending");

                // Simulate success if in silent mode
                if (silentMode) {
                    setTimeout(() => {
                        setStatus("success");
                        setText("");
                        setTimeout(() => setStatus("idle"), 3000);
                    }, 500);
                    return;
                }

                try {
                    await fetch("https://formsubmit.co/ajax/karadaglisp@gmail.com", {
                        method: "POST",
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            _subject: `üí° New App Idea: ${type.toUpperCase()}`,
                            category: type,
                            message: text,
                            timestamp: new Date().toLocaleString(),
                            _captcha: "false"
                        })
                    });
                    setStatus("success");
                    setText("");
                    setTimeout(() => setStatus("idle"), 3000);
                } catch (err) {
                    console.error(err);
                    setStatus("error");
                    setTimeout(() => setStatus("idle"), 3000);
                }
            };

            const getTypeLabel = (t) => {
                switch(t) {
                    case 'feature': return 'New Feature';
                    case 'improvement': return 'Bring back an old feature';
                    case 'removal': return 'Remove This';
                    case 'message': return 'Just a Msg';
                    default: return t;
                }
            };

            return (
                <div className="h-full w-full overflow-y-auto p-6 flex flex-col items-center pt-10 pb-24 max-w-lg mx-auto relative z-10 animate-in fade-in">
                    <div className="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mb-6 shadow-inner border border-slate-700">
                        <span className="text-4xl">üí°</span>
                    </div>
                    <h2 className="text-3xl font-serif text-pink-200 mb-2 text-center">The Suggestion Box</h2>
                    <p className="text-slate-400 text-sm mb-8 text-center max-w-xs">Tell me what you want, what you hate, or leave a note for the developer (me).</p>

                    <form onSubmit={handleSubmit} className="w-full bg-slate-900/80 p-6 rounded-2xl border border-slate-700 backdrop-blur-sm shadow-xl">
                        {/* Type Selection */}
                        <label className="text-xs text-slate-500 font-bold uppercase tracking-wider mb-3 block">Category</label>
                        <div className="grid grid-cols-2 gap-2 mb-6">
                            {['feature', 'improvement', 'removal', 'message'].map(t => (
                                <button
                                    key={t}
                                    type="button"
                                    onClick={() => setType(t)}
                                    className={`p-3 rounded-lg text-xs font-bold uppercase tracking-wider border transition-all ${
                                        type === t 
                                        ? 'bg-pink-600 border-pink-500 text-white shadow-[0_0_15px_rgba(236,72,153,0.4)] scale-105' 
                                        : 'bg-slate-800 border-slate-600 text-slate-400 hover:bg-slate-700 hover:text-slate-200'
                                    }`}
                                >
                                    {getTypeLabel(t)}
                                </button>
                            ))}
                        </div>

                        <label className="text-xs text-slate-500 font-bold uppercase tracking-wider mb-2 block">Your Thoughts</label>
                        <textarea
                            value={text}
                            onChange={e => setText(e.target.value)}
                            placeholder="type here"
                            className="w-full h-40 bg-slate-950 border border-slate-700 rounded-xl p-4 text-white placeholder-slate-600 outline-none focus:border-pink-500 focus:ring-1 focus:ring-pink-500 transition-all mb-6 resize-none"
                        />

                        <button
                            type="submit"
                            disabled={status === 'sending' || !text.trim()}
                            className={`w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all transform active:scale-95 shadow-lg ${
                                status === 'success' ? 'bg-green-600 text-white' :
                                status === 'error' ? 'bg-red-600 text-white' :
                                'bg-gradient-to-r from-pink-600 to-purple-600 text-white hover:from-pink-500 hover:to-purple-500'
                            } disabled:opacity-50 disabled:cursor-not-allowed`}
                        >
                            {status === 'sending' ? (
                                <><span>Sending...</span></>
                            ) : status === 'success' ? (
                                <><span>Sent! üíå</span></>
                            ) : status === 'error' ? (
                                <><span>Error üòì Try again</span></>
                            ) : (
                                <><span>Send Feedback</span><PenTool size={16} /></>
                            )}
                        </button>
                    </form>
                </div>
            );
        };

        // --- PAGE: MESSAGE ---
        const MsgPage = () => {
            return ( 
                <div className="min-h-screen flex flex-col items-center justify-center p-8 text-center animate-in fade-in duration-1000 relative z-10 pb-24"> 
                    <div className="w-32 h-32 rounded-full overflow-hidden border-4 border-pink-500 shadow-[0_0_30px_rgba(236,72,153,0.6)] mb-8 bg-slate-800 flex items-center justify-center transform hover:scale-105 transition-transform duration-500"> 
                        <span className="text-6xl">üñ§</span> 
                    </div> 
                    <h1 className="text-3xl md:text-5xl font-serif text-white mb-8 tracking-wide drop-shadow-lg">
                        For the hottest black pantheress
                    </h1> 
                    <div className="max-w-md bg-white/5 backdrop-blur-md p-8 rounded-2xl border border-pink-500/20 text-lg md:text-xl leading-relaxed text-pink-100 font-serif italic shadow-xl"> 
                        <p> 
                            I can't get over your dark aesthetic, your obsession with nectarines, and the way you look at me when I say something you like. I melt everytime you whisper my name or say that you want me. Keep s(p)it(t)ing on my face pls ü´†
                        </p> 
                    </div> 
                    <div className="mt-12 text-sm text-slate-500 font-mono opacity-60"> 
                        coded with ‚ù§Ô∏è by Banos 
                    </div> 
                </div> 
            );
        };

        // --- PAGE: ADVENT ---
        const AdventPage = ({ silentMode }) => {
             // Range: Dec 30, 2025 to Jan 26, 2026
            const ADVENT_DATA = [
                { day: 30, month: 11, year: 2025, icon: "‚ú®", title: "Manifest", text: "What do you want for the new year? Type it below and send it to the stars." },
                { day: 31, month: 11, year: 2025, icon: "ü•Ç", title: "NYE", text: "I wish I could drink tonight's wine from your mouthüôÑ. Happy new year<3 Tap the screen to celebrate!" },
                { day: 1, month: 0, year: 2026, icon: "üéÜ", title: "2026", text: "New year, same obsession with you. Break the cookie to reveal your fortune." },
                { day: 2, month: 0, year: 2026, icon: "üì¶", title: "Gift!", text: "Pop some bubbles to relax. The same bubbles that cover the gift you'll receive todayüò¨" },
                { day: 3, month: 0, year: 2026, icon: "üêà‚Äç‚¨õ", title: "Us", text: "You are the fiercest black cat. Scratch my skin whenever you feel like it." },
                { day: 4, month: 0, year: 2026, icon: "üíã", title: "Kisses", text: "I want to kiss you everywhere. Tap the box to leave a mark." },
                { day: 5, month: 0, year: 2026, icon: "üéÅ", title: "The Stars", text: "Our schedules never aligned, but it's nice to think that some day might. Bye <3" },
                { day: 13, month: 0, year: 2026, icon: "üìù", title: "Exam Day", text: "I know you crushed it (or will crush it)! Tap the stress monster to defeat it." },
                { day: 14, month: 0, year: 2026, icon: "üçÉ", title: "Ti 9.33 re mlkkkk (<3)", text: "Breathe in, breathe out. You did great. Take a moment to just be." },
                { day: 19, month: 0, year: 2026, icon: "üî¶", title: "Fireflies", text: "Catch your glow." },
                { day: 20, month: 0, year: 2026, icon: "üåå", title: "Stardust", text: "making something for you at the moment" },
                { day: 21, month: 0, year: 2026, icon: "üå±", title: "Bloom", text: "Keep watering your mind like this seed. (nai, se eipa fyto)" },
                { day: 22, month: 0, year: 2026, icon: "üéà", title: "Float", text: "Let things go. Pop the balloons before they fly away." },
                { day: 22, month: 0, year: 2026, icon: "üé≠", title: "P.S.", text: "Hey, let me know about this.." },
                { day: 23, month: 0, year: 2026, icon: "üéπ", title: "Melody", text: "Make a little noise. It's okay to be loud." },
                { day: 24, month: 0, year: 2026, icon: "üé®", title: "Pixels", text: "Draw something random. No rules." },
                { day: 25, month: 0, year: 2026, icon: "üß†", title: "Memory", text: "Find the pairs." },
                { day: 26, month: 0, year: 2026, icon: "üîÆ", title: "Oracle", text: "Focus on a question. Tap to reveal the answer." }
            ];

             const SurpriseInteraction = ({ dayItem }) => {
                const [tapCount, setTapCount] = useState(0);
                const [textInput, setTextInput] = useState("");
                const [completed, setCompleted] = useState(false);
                const [sending, setSending] = useState(false);
                const [items, setItems] = useState([]);

                // --- SPECIAL: P.S. INVITATION ---
                if (dayItem.title === "P.S.") {
                    const [status, setStatus] = useState('idle'); // idle, sending, sent
                    const [noAttempts, setNoAttempts] = useState(0);
                    const [responseMsg, setResponseMsg] = useState(null);

                    const sendResponse = async (answer) => {
                        setStatus('sending');
                        
                        if (silentMode) {
                            setTimeout(() => {
                                setStatus('sent');
                                setResponseMsg(answer === "Yes" ? "Yay! <3 See you there!" : "Okay, some other time. Good luck with your test! <3");
                            }, 500);
                            return;
                        }

                        try {
                            await fetch("https://formsubmit.co/ajax/karadaglisp@gmail.com", {
                                method: "POST",
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json'
                                },
                                body: JSON.stringify({
                                    _subject: `üé≠ Play Invitation Response: ${answer}`,
                                    response: answer,
                                    timestamp: new Date().toLocaleString(),
                                    _captcha: "false"
                                })
                            });
                            setStatus('sent');
                            setResponseMsg(answer === "Yes" ? "Yay! <3 See you there!" : "Okay, some other time. Good luck with your test! <3");
                        } catch (e) {
                            console.error(e);
                            setStatus('sent'); 
                            setResponseMsg(answer === "Yes" ? "Yay! <3 (Email might have failed but I know you said Yes)" : "Okay, some other time. Good luck with your test! <3");
                        }
                    };

                    const handleNo = () => {
                        if (noAttempts === 0) {
                            setNoAttempts(1);
                        } else if (noAttempts === 1) {
                            setNoAttempts(2);
                        } else {
                            sendResponse("No");
                        }
                    };

                    if (status === 'sent') {
                        return <div className="mt-8 text-pink-400 font-bold text-xl animate-bounce">{responseMsg}</div>;
                    }

                    if (status === 'sending') {
                         return <div className="mt-8 text-slate-400 animate-pulse">Sending response... üïäÔ∏è</div>;
                    }

                    return (
                        <div className="mt-4 flex flex-col gap-4 text-left bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                            <p className="text-sm text-slate-200 leading-relaxed font-sans">
                                I have a double ticket for a play called <a href="https://www.more.com/gr-el/tickets/theater/don-zouan-thessaloniki/" target="_blank" className="text-pink-400 underline font-bold hover:text-pink-300">"ŒîŒøŒΩ ŒñŒøœÖŒ¨ŒΩ"</a> for tomorrow at 21:00 at Aristotelion.
                            </p>
                            <p className="text-sm text-slate-200 font-sans">
                                Do you want to come with me? Let me know until tomorrow at 14:00.
                            </p>
                            <p className="text-center font-bold text-pink-300 mt-2 font-serif text-lg animate-pulse">
                                GOOD LUCK WITH YOUR TEST
                            </p>
                            
                            {noAttempts > 0 && (
                                <div className="bg-red-500/20 border border-red-500/50 p-2 rounded text-center animate-bounce">
                                    <p className="text-xs text-red-200 font-bold">
                                        {noAttempts === 1 ? "I think you missclicked... ü§®" : "Are you suuure? The button on the left is nicer... ü•∫"}
                                    </p>
                                </div>
                            )}

                            <div className="flex gap-4 justify-center mt-2">
                                <button 
                                    onClick={() => sendResponse("Yes")}
                                    className="px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white rounded-xl font-bold shadow-lg transition-transform hover:scale-105 active:scale-95"
                                >
                                    Yes
                                </button>
                                <button 
                                    onClick={handleNo}
                                    className="px-8 py-3 bg-slate-700 hover:bg-red-500/80 text-white rounded-xl font-bold shadow-lg transition-transform hover:scale-105 active:scale-95"
                                >
                                    No
                                </button>
                            </div>
                        </div>
                    );
                }

                // --- DAY 30: MANIFEST ---
                if (dayItem.title === "Manifest") {
                    const sendWish = async () => {
                        if (!textInput.trim()) return;
                        setSending(true);
                        
                        if (!silentMode) {
                            try {
                                await fetch("https://formsubmit.co/ajax/karadaglisp@gmail.com", {
                                    method: "POST",
                                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                                    body: JSON.stringify({ _subject: "‚ú® New Wish from Midnight Picnic", wish: textInput })
                                });
                            } catch (error) { console.error("Error sending wish:", error); }
                        }
                        
                        setSending(false);
                        setCompleted(true);
                    };

                    return (
                        <div className="mt-4 w-full">
                            {completed ? (
                                <div className="text-center animate-pulse text-yellow-300">
                                    <div className="text-4xl mb-2">‚ú®üå†‚ú®</div>
                                    <p className="font-serif italic">Your wish has been sent to the universe.</p>
                                </div>
                            ) : (
                                <div className="flex flex-col gap-2">
                                    <input 
                                        type="text" 
                                        value={textInput}
                                        onChange={(e) => setTextInput(e.target.value)}
                                        placeholder="I wish for..." 
                                        className="bg-slate-800 border border-slate-600 rounded p-2 text-white text-center focus:border-pink-500 outline-none"
                                        disabled={sending}
                                    />
                                    <button 
                                        onClick={sendWish} 
                                        disabled={sending}
                                        className="bg-pink-600 hover:bg-pink-500 text-white rounded p-2 font-bold disabled:opacity-50 transition-colors"
                                    >
                                        {sending ? "Sending..." : "Send to Stars"}
                                    </button>
                                </div>
                            )}
                        </div>
                    );
                }

                // --- DAY 31: FIREWORKS ---
                if (dayItem.title === "NYE") {
                    const addFirework = (e) => {
                        const rect = e.currentTarget.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        const baseId = Date.now() + Math.random();
                        const colors = ['#ef4444', '#f97316', '#f59e0b', '#84cc16', '#06b6d4', '#8b5cf6', '#d946ef', '#f43f5e'];
                        
                        const newParticles = [];
                        for(let i=0; i<40; i++) {
                            const angle = (Math.PI * 2 * i) / 40;
                            const velocity = 50 + Math.random() * 100;
                            newParticles.push({
                                id: baseId + i,
                                x, y,
                                color: colors[Math.floor(Math.random() * colors.length)],
                                tx: Math.cos(angle) * velocity + (Math.random() * 20 - 10) + 'px',
                                ty: Math.sin(angle) * velocity + (Math.random() * 20 - 10) + 'px',
                                size: Math.random() * 4 + 2 + 'px'
                            });
                        }
                        setItems(prev => [...prev, ...newParticles]);
                        setTimeout(() => setItems(prev => prev.filter(p => p.id < baseId)), 2500);
                    };

                    return (
                        <div 
                            className="mt-4 w-full h-48 bg-slate-900 rounded-xl relative overflow-hidden cursor-pointer border border-slate-600 touch-none shadow-inner"
                            onClick={addFirework}
                            style={{background: 'radial-gradient(circle at bottom, #1e293b 0%, #020617 100%)'}}
                        >
                            <div className="absolute inset-0 flex items-center justify-center text-slate-500 pointer-events-none font-mono text-xs opacity-60">Tap anywhere for magic</div>
                            {items.map(p => (
                                <div key={p.id} className="absolute rounded-full firework-particle" style={{ left: p.x, top: p.y, width: p.size, height: p.size, backgroundColor: p.color, boxShadow: `0 0 6px ${p.color}`, '--tx': p.tx, '--ty': p.ty }}></div>
                            ))}
                        </div>
                    );
                }

                // --- JAN 1: FORTUNE ---
                if (dayItem.title === "2026") {
                    const message = "This year is going to be spicyüå∂Ô∏è. You will achieve greatness üëë in Germany. And you'll become even sexierü´†.";
                    const reveal = () => { if (!completed) setCompleted(true); };

                    return (
                        <div className="mt-8 flex flex-col items-center justify-center relative h-40 w-full cursor-pointer perspective-1000" onClick={reveal}>
                             <div className={`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white text-slate-900 p-3 shadow-2xl border-l-4 border-pink-500 font-serif text-sm text-center italic w-64 z-10 transition-all duration-1000 origin-center ${completed ? 'scale-100 opacity-100 rotate-[-1deg]' : 'scale-0 opacity-0 rotate-[10deg]'}`}>
                                {message}
                             </div>
                             <div className={`absolute z-20 transition-all duration-1000 ease-out ${completed ? '-translate-x-16 translate-y-8 rotate-[-30deg] opacity-0' : 'translate-x-0'}`}>
                                 <svg width="60" height="100" viewBox="0 0 60 100" className="drop-shadow-xl" style={{overflow: 'visible'}}>
                                    <path d="M60,25 Q10,10 10,70 Q35,85 60,75 Z" fill="#fcd34d" stroke="#d97706" strokeWidth="2" />
                                    <path d="M20,65 Q30,75 50,70" fill="none" stroke="#d97706" strokeWidth="1" opacity="0.5" />
                                 </svg>
                             </div>
                             <div className={`absolute z-20 transition-all duration-1000 ease-out ${completed ? 'translate-x-16 translate-y-8 rotate-[30deg] opacity-0' : 'translate-x-0'}`}>
                                 <svg width="60" height="100" viewBox="0 0 60 100" className="drop-shadow-xl" style={{overflow: 'visible', marginLeft: '-2px'}}> 
                                    <path d="M0,25 Q50,10 50,70 Q25,85 0,75 Z" fill="#fcd34d" stroke="#d97706" strokeWidth="2" />
                                    <path d="M40,65 Q30,75 10,70" fill="none" stroke="#d97706" strokeWidth="1" opacity="0.5" />
                                 </svg>
                             </div>
                             {!completed && <div className="absolute -bottom-8 w-full text-center text-xs text-slate-500 font-mono tracking-widest uppercase animate-pulse">Tap to Crack</div>}
                        </div>
                    );
                }

                // --- JAN 2: BUBBLE WRAP ---
                if (dayItem.title === "Gift!") {
                    if (items.length === 0 && !completed) { setItems(Array(15).fill(false)); setCompleted(true); }

                    const playPop = () => {
                        try {
                            const AudioContext = window.AudioContext || window.webkitAudioContext;
                            if (!AudioContext) return;
                            const ctx = new AudioContext();
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.connect(gain); gain.connect(ctx.destination);
                            osc.type = 'sine'; osc.frequency.setValueAtTime(800, ctx.currentTime);
                            osc.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.1);
                            gain.gain.setValueAtTime(0.3, ctx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                            osc.start(); osc.stop(ctx.currentTime + 0.1);
                        } catch (e) {}
                    };
                    
                    const pop = (idx) => {
                        const newItems = [...items];
                        if (!newItems[idx]) { playPop(); newItems[idx] = true; setItems(newItems); }
                    };

                    return (
                        <div className="mt-4 grid grid-cols-5 gap-2 bg-slate-800 p-3 rounded-xl border border-slate-700">
                            {items.map((popped, idx) => (
                                <button key={idx} onClick={() => pop(idx)} className={`w-full aspect-square rounded-full transition-all ${popped ? 'bg-slate-900 shadow-inner scale-90 opacity-50' : 'bg-pink-500/20 hover:bg-pink-500/40 border border-pink-500/30 shadow-lg cursor-pointer active:scale-90'}`}>
                                    {popped && <span className="text-[8px]">pop</span>}
                                </button>
                            ))}
                        </div>
                    );
                }

                // --- JAN 3: PET CAT ---
                if (dayItem.title === "Us") {
                    return (
                        <div className="mt-4 flex flex-col items-center">
                            <button onClick={() => setTapCount(p => p + 1)} className="text-6xl transition-transform active:scale-90 hover:scale-110 relative group">
                                üêà‚Äç‚¨õ
                                <div className="absolute -top-4 -right-4 text-2xl opacity-0 group-active:opacity-100 transition-opacity animate-bounce">‚ù§Ô∏è</div>
                            </button>
                            <div className="mt-2 font-mono text-pink-300 text-sm">{tapCount} Pets Given</div>
                        </div>
                    );
                }

                // --- JAN 4: KISSES ---
                if (dayItem.title === "Kisses") {
                    const addKiss = (e) => {
                        const rect = e.currentTarget.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        const rotation = Math.random() * 40 - 20;
                        setItems(prev => [...prev, { id: Date.now(), x, y, rotation }]);
                    };
                    
                    return (
                        <div className="mt-4 w-full h-40 bg-pink-100/10 rounded-xl relative overflow-hidden border border-pink-500/30 cursor-pointer active:bg-pink-100/20 transition-colors touch-none" onClick={addKiss}>
                             {items.length === 0 && <div className="absolute inset-0 flex items-center justify-center text-pink-300/50 font-mono text-xs pointer-events-none">Tap to kiss</div>}
                            {items.map((k) => (
                                <div key={k.id} className="absolute text-4xl animate-in zoom-in duration-200" style={{ left: k.x - 15, top: k.y - 15, transform: `rotate(${k.rotation}deg)`, opacity: 0.8 }}>üíã</div>
                            ))}
                            {items.length > 0 && <button onClick={(e) => {e.stopPropagation(); setItems([]);}} className="absolute bottom-2 right-2 text-xs text-slate-400 hover:text-white bg-slate-900/50 px-2 py-1 rounded">Clear</button>}
                        </div>
                    );
                }

                // --- JAN 5 (THE STARS) ---
                if (dayItem.title === "The Stars") {
                    const nextState = () => { if (tapCount < 2) setTapCount(p => p + 1); };
                    return (
                        <div className="mt-6 flex justify-center pb-4">
                            <button onClick={nextState} className="relative w-32 h-32 flex items-center justify-center transition-transform hover:scale-105 active:scale-95">
                                {tapCount === 0 && <div className="text-8xl animate-bounce">üéÅ</div>}
                                {tapCount === 1 && <div className="text-8xl">üì¶</div>}
                                {tapCount === 2 && (
                                    <div className="animate-in zoom-in duration-500 text-center">
                                        <div className="text-6xl mb-2">ü™ê</div>
                                        <div className="text-4xl mb-2">‚ú®</div>
                                        <div className="text-xs text-pink-300 font-bold bg-slate-900/80 px-2 py-1 rounded border border-pink-500/50">For your room</div>
                                    </div>
                                )}
                            </button>
                        </div>
                    );
                }

                // --- JAN 13: STRESS MONSTER ---
                if (dayItem.title === "Exam Day") {
                    const [health, setHealth] = useState(10);
                    
                    const hitMonster = () => {
                        if (health > 0) {
                            setHealth(h => h - 1);
                        }
                    };

                    if (health <= 0) {
                        return (
                            <div className="mt-4 text-center animate-in zoom-in duration-500">
                                <div className="text-6xl mb-2">üéâ</div>
                                <p className="text-pink-300 font-bold">Stress Defeated!</p>
                                <p className="text-sm text-slate-400">Time to relax.</p>
                            </div>
                        );
                    }

                    return (
                        <div className="mt-4 flex flex-col items-center">
                            <div className="w-full bg-slate-800 h-4 rounded-full mb-4 overflow-hidden border border-slate-600">
                                <div 
                                    className="bg-red-500 h-full transition-all duration-200 ease-out" 
                                    style={{ width: `${(health / 10) * 100}%` }}
                                />
                            </div>
                            <button 
                                onClick={hitMonster} 
                                className="text-8xl active:scale-90 transition-transform cursor-pointer hover:scale-110 filter drop-shadow-lg"
                            >
                                üëæ
                            </button>
                            <p className="mt-2 text-xs text-slate-500 font-mono">Tap to attack!</p>
                        </div>
                    );
                }

                // --- JAN 14: BUBBLE GAME ---
                if (dayItem.title === "Ti 9.33 re mlkkkk (<3)") {
                    const [score, setScore] = useState(0);
                    const [timeLeft, setTimeLeft] = useState(10);
                    const [isPlaying, setIsPlaying] = useState(false);
                    const [bubbles, setBubbles] = useState([]);
                    const [gameOver, setGameOver] = useState(false);

                    useEffect(() => {
                        if (isPlaying && timeLeft > 0) {
                            const timer = setInterval(() => setTimeLeft(t => t - 1), 1000);
                            const spawner = setInterval(() => {
                                setBubbles(prev => [
                                    ...prev, 
                                    { 
                                        id: Date.now(), 
                                        x: Math.random() * 80 + 10, 
                                        y: Math.random() * 80 + 10,
                                        size: Math.random() * 20 + 30 
                                    }
                                ]);
                            }, 500);
                            return () => { clearInterval(timer); clearInterval(spawner); };
                        } else if (timeLeft === 0 && isPlaying) {
                            setIsPlaying(false);
                            setGameOver(true);
                        }
                    }, [isPlaying, timeLeft]);

                    const startGame = () => {
                        setScore(0);
                        setTimeLeft(10);
                        setBubbles([]);
                        setGameOver(false);
                        setIsPlaying(true);
                    };

                    const popBubble = (id) => {
                        setBubbles(prev => prev.filter(b => b.id !== id));
                        setScore(s => s + 1);
                    };

                    if (gameOver) {
                        return (
                            <div className="mt-4 text-center">
                                <p className="text-4xl font-bold text-white mb-2">{score}</p>
                                <p className="text-pink-300 mb-4">Bubbles Popped!</p>
                                <button 
                                    onClick={startGame}
                                    className="px-6 py-2 bg-white text-black rounded-full font-bold hover:bg-pink-200 transition-colors"
                                >
                                    Play Again
                                </button>
                            </div>
                        );
                    }

                    if (!isPlaying) {
                        return (
                            <div className="mt-4 text-center">
                                <button 
                                    onClick={startGame}
                                    className="px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-full font-bold hover:scale-105 transition-transform shadow-lg"
                                >
                                    Start Game
                                </button>
                                <p className="mt-2 text-xs text-slate-400">Pop as many as you can in 10s!</p>
                            </div>
                        );
                    }

                    return (
                        <div className="mt-4 w-full h-48 bg-slate-800 rounded-xl relative overflow-hidden border border-slate-600">
                            <div className="absolute top-2 right-2 font-mono text-white bg-black/50 px-2 rounded">
                                00:{timeLeft < 10 ? `0${timeLeft}` : timeLeft}
                            </div>
                            <div className="absolute top-2 left-2 font-bold text-pink-400">
                                Score: {score}
                            </div>
                            {bubbles.map(b => (
                                <div
                                    key={b.id}
                                    onClick={(e) => { e.stopPropagation(); popBubble(b.id); }}
                                    className="absolute rounded-full bg-pink-400/30 border border-pink-200/50 cursor-pointer active:scale-90 transition-transform animate-in zoom-in duration-300"
                                    style={{
                                        left: `${b.x}%`,
                                        top: `${b.y}%`,
                                        width: `${b.size}px`,
                                        height: `${b.size}px`,
                                        transform: 'translate(-50%, -50%)'
                                    }}
                                />
                            ))}
                        </div>
                    );
                }

                // --- JAN 19: FIREFLIES ---
                if (dayItem.title === "Fireflies") {
                    const [fireflies, setFireflies] = useState([]);
                    
                    useEffect(() => {
                        const count = 10;
                        const initial = [];
                        for(let i=0; i<count; i++) {
                            initial.push({
                                id: i,
                                x: Math.random() * 100,
                                y: Math.random() * 100,
                                tx: Math.random() * 100,
                                ty: Math.random() * 100,
                                speed: 2 + Math.random() * 5
                            });
                        }
                        setFireflies(initial);
                        
                        const interval = setInterval(() => {
                            setFireflies(prev => prev.map(f => {
                                // Simple drift movement logic towards target
                                const dx = f.tx - f.x;
                                const dy = f.ty - f.y;
                                const dist = Math.sqrt(dx*dx + dy*dy);
                                if (dist < 5) {
                                    return { ...f, tx: Math.random() * 100, ty: Math.random() * 100 };
                                }
                                return {
                                    ...f,
                                    x: f.x + (dx / dist) * 0.5,
                                    y: f.y + (dy / dist) * 0.5
                                };
                            }));
                        }, 50);
                        return () => clearInterval(interval);
                    }, []);

                    const catchFly = (id) => {
                        setFireflies(prev => prev.filter(f => f.id !== id));
                    };

                    return (
                        <div className="mt-4 w-full h-48 bg-slate-900 rounded-xl relative overflow-hidden border border-slate-700">
                            {fireflies.length === 0 && <div className="absolute inset-0 flex items-center justify-center text-yellow-200 animate-pulse font-serif">All caught! ‚ú®</div>}
                            {fireflies.map(f => (
                                <div 
                                    key={f.id}
                                    onClick={() => catchFly(f.id)}
                                    className="absolute w-4 h-4 bg-yellow-300 rounded-full blur-[2px] cursor-pointer transition-transform duration-75 ease-linear shadow-[0_0_10px_gold]"
                                    style={{ left: `${f.x}%`, top: `${f.y}%`, transform: 'translate(-50%, -50%)' }}
                                />
                            ))}
                        </div>
                    );
                }

                // --- JAN 20: STARDUST ---
                if (dayItem.title === "Stardust") {
                    // Ursa Major (0-6) and Bootes (7-12)
                    const positions = [
                        // Ursa Major
                        {x: 15, y: 40}, {x: 23, y: 38}, {x: 30, y: 40}, // Handle
                        {x: 38, y: 45}, {x: 38, y: 55}, {x: 50, y: 55}, {x: 50, y: 45}, // Bowl
                        // Bootes
                        {x: 70, y: 20}, {x: 62, y: 25}, {x: 78, y: 30}, // Top
                        {x: 70, y: 50}, {x: 75, y: 75}, {x: 85, y: 70}  // Bottom (Arcturus is 75,75)
                    ];
                    
                    const connections = [
                        // Ursa Major
                        [0,1], [1,2], [2,3], [3,4], [4,5], [5,6], [6,3],
                        // Bootes
                        [7,8], [8,10], [10,11], [11,12], [10,9], [9,7]
                    ];

                    const [stars, setStars] = useState(Array(positions.length).fill(false));
                    
                    const toggleStar = (idx) => {
                        const newStars = [...stars];
                        newStars[idx] = !newStars[idx];
                        setStars(newStars);
                    };

                    return (
                        <div className="mt-4 w-full h-48 bg-slate-950 rounded-xl relative overflow-hidden border border-slate-700">
                            <svg className="absolute inset-0 w-full h-full pointer-events-none">
                                {connections.map(([start, end], i) => (
                                    <line 
                                        key={i}
                                        x1={`${positions[start].x}%`} 
                                        y1={`${positions[start].y}%`} 
                                        x2={`${positions[end].x}%`} 
                                        y2={`${positions[end].y}%`} 
                                        stroke="rgba(255,255,255,0.4)" 
                                        strokeWidth="1.5" 
                                        className="transition-opacity duration-500"
                                        style={{ opacity: stars[start] && stars[end] ? 1 : 0 }}
                                    />
                                ))}
                            </svg>
                            {positions.map((p, i) => (
                                <div 
                                    key={i}
                                    onClick={() => toggleStar(i)}
                                    className={`absolute w-6 h-6 rounded-full flex items-center justify-center cursor-pointer transition-all duration-300 z-10`}
                                    style={{ left: `${p.x}%`, top: `${p.y}%`, transform: 'translate(-50%, -50%)' }}
                                >
                                    <div className={`w-2 h-2 rounded-full transition-all duration-300 ${stars[i] ? 'bg-white shadow-[0_0_10px_white] scale-125' : 'bg-slate-600 hover:bg-slate-500'}`} />
                                </div>
                            ))}
                        </div>
                    );
                }

                // --- JAN 21: BLOOM ---
                if (dayItem.title === "Bloom") {
                    const [growth, setGrowth] = useState(0);
                    const water = () => {
                        setGrowth(g => Math.min(g + 10, 100));
                    };

                    return (
                        <div className="mt-4 flex flex-col items-center">
                            <div className="w-full h-40 relative flex items-end justify-center pb-4">
                                <div className="absolute bottom-0 w-2 h-20 bg-green-800 rounded-full origin-bottom transition-all duration-1000" style={{ height: `${growth * 0.8}%`, opacity: growth > 0 ? 1 : 0 }}></div>
                                {growth > 30 && <div className="absolute bottom-[30%] w-8 h-4 bg-green-600 rounded-full rounded-tr-none -translate-x-4"></div>}
                                {growth > 60 && <div className="absolute bottom-[60%] w-8 h-4 bg-green-600 rounded-full rounded-tl-none translate-x-4"></div>}
                                {growth === 100 && (
                                    <div className="absolute bottom-[80%] text-6xl animate-in zoom-in duration-500">üå∫</div>
                                )}
                                {growth < 100 && (
                                    <button 
                                        onClick={water}
                                        className="absolute top-4 right-4 bg-blue-500/20 p-2 rounded-full hover:bg-blue-500/40 transition-colors"
                                    >
                                        üíß
                                    </button>
                                )}
                            </div>
                            <div className="w-full bg-slate-800 h-2 rounded-full mt-2">
                                <div className="bg-blue-500 h-full rounded-full transition-all duration-300" style={{ width: `${growth}%` }}></div>
                            </div>
                        </div>
                    );
                }

                // --- JAN 22: FLOAT ---
                if (dayItem.title === "Float") {
                    const [balloons, setBalloons] = useState([]);
                    const [popMessages, setPopMessages] = useState([]);
                    const messages = ["You got this!", "So proud", "Breathe", "Doing great", "Keep going", "You're magic", "Stay cool", "Relax", "Stress free", "Good vibes", "You shine", "Keep floating"];
                    
                    useEffect(() => {
                        const interval = setInterval(() => {
                            if (Math.random() > 0.7) {
                                setBalloons(prev => [
                                    ...prev,
                                    {
                                        id: Date.now(),
                                        x: Math.random() * 80 + 10,
                                        bottom: -20,
                                        color: ['#f472b6', '#c084fc', '#60a5fa'][Math.floor(Math.random() * 3)],
                                        speed: 0.5 + Math.random() * 1
                                    }
                                ]);
                            }
                            setBalloons(prev => prev
                                .map(b => ({ ...b, bottom: b.bottom + b.speed }))
                                .filter(b => b.bottom < 120)
                            );
                        }, 50);
                        return () => clearInterval(interval);
                    }, []);

                    const pop = (id, x, bottom) => {
                        setBalloons(prev => prev.filter(b => b.id !== id));
                        const text = messages[Math.floor(Math.random() * messages.length)];
                        const msgId = Date.now();
                        setPopMessages(prev => [...prev, { id: msgId, x, bottom, text }]);
                        setTimeout(() => setPopMessages(prev => prev.filter(m => m.id !== msgId)), 1000);
                    };

                    return (
                        <div className="mt-4 w-full h-48 bg-sky-900/30 rounded-xl relative overflow-hidden border border-slate-700">
                            {balloons.map(b => (
                                <div 
                                    key={b.id}
                                    onClick={() => pop(b.id, b.x, b.bottom)}
                                    className="absolute w-8 h-10 rounded-full cursor-pointer opacity-90 hover:scale-110 transition-transform active:scale-90"
                                    style={{ 
                                        left: `${b.x}%`, 
                                        bottom: `${b.bottom}%`,
                                        backgroundColor: b.color,
                                        boxShadow: 'inset -2px -2px 6px rgba(0,0,0,0.2)'
                                    }}
                                >
                                    <div className="absolute bottom-[-10px] left-1/2 w-[1px] h-[10px] bg-white/50 -translate-x-1/2"></div>
                                </div>
                            ))}
                            {popMessages.map(m => (
                                <div 
                                    key={m.id}
                                    className="absolute text-xs font-bold text-white pointer-events-none animate-in zoom-in fade-out duration-1000 whitespace-nowrap"
                                    style={{ 
                                        left: `${m.x}%`, 
                                        bottom: `${m.bottom}%`,
                                        transform: 'translate(-50%, -50%)',
                                        textShadow: '0 0 4px rgba(236, 72, 153, 0.8)'
                                    }}
                                >
                                    {m.text}
                                </div>
                            ))}
                        </div>
                    );
                }

                // --- JAN 23: MELODY ---
                if (dayItem.title === "Melody") {
                    const [isSongMode, setIsSongMode] = useState(false);
                    const songRef = useRef(null);

                    const playNote = (freq) => {
                        try {
                            const AudioContext = window.AudioContext || window.webkitAudioContext;
                            const ctx = new AudioContext();
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.connect(gain); gain.connect(ctx.destination);
                            osc.type = 'sine'; 
                            osc.frequency.setValueAtTime(freq, ctx.currentTime);
                            gain.gain.setValueAtTime(0.2, ctx.currentTime); 
                            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                            osc.start(); osc.stop(ctx.currentTime + 0.5);
                        } catch(e) {}
                    };

                    const playSong = (index) => {
                        if (songRef.current) {
                            songRef.current.pause();
                            songRef.current.currentTime = 0;
                        }
                        const audio = new Audio(`${index + 1}.mp3`);
                        songRef.current = audio;
                        audio.play().catch(e => console.log("Audio play error", e));
                    };

                    const handlePress = (index, freq) => {
                        if (isSongMode) {
                            playSong(index);
                        } else {
                            playNote(freq);
                        }
                    };

                    const notes = [
                        { label: 'C', freq: 261.63, color: 'bg-red-500' },
                        { label: 'D', freq: 293.66, color: 'bg-orange-500' },
                        { label: 'E', freq: 329.63, color: 'bg-yellow-500' },
                        { label: 'F', freq: 349.23, color: 'bg-green-500' },
                        { label: 'G', freq: 392.00, color: 'bg-blue-500' },
                    ];

                    return (
                        <div className="mt-4 flex flex-col items-center">
                            <div className="flex bg-slate-800 p-1 rounded-full mb-4">
                                <button 
                                    onClick={() => setIsSongMode(false)}
                                    className={`px-4 py-1 rounded-full text-xs font-bold transition-colors ${!isSongMode ? 'bg-pink-500 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Notes
                                </button>
                                <button 
                                    onClick={() => setIsSongMode(true)}
                                    className={`px-4 py-1 rounded-full text-xs font-bold transition-colors ${isSongMode ? 'bg-purple-500 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Songs
                                </button>
                            </div>

                            <div className="flex gap-2 justify-center h-32 items-end">
                                {notes.map((n, i) => (
                                    <button
                                        key={i}
                                        onClick={() => handlePress(i, n.freq)}
                                        className={`w-10 rounded-t-xl transition-all active:h-24 hover:opacity-90 ${n.color}`}
                                        style={{ height: `${40 + i * 10}%` }}
                                    >
                                        <span className="text-black/50 font-bold text-xs">{isSongMode ? i + 1 : n.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    );
                }

                // --- JAN 24: PIXELS ---
                if (dayItem.title === "Pixels") {
                    const [grid, setGrid] = useState(Array(64).fill('#1e293b')); // 8x8
                    const colors = ['#1e293b', '#ef4444', '#f59e0b', '#22c55e', '#3b82f6', '#a855f7', '#ffffff'];
                    const [activeColor, setActiveColor] = useState('#ffffff');
                    const [isSending, setIsSending] = useState(false);
                    const [isSent, setIsSent] = useState(false);

                    const paint = (idx) => {
                        const newGrid = [...grid];
                        newGrid[idx] = activeColor;
                        setGrid(newGrid);
                    };

                    const sendArt = async () => {
                        setIsSending(true);
                        
                        if (silentMode) {
                            setTimeout(() => {
                                setIsSent(true);
                                setIsSending(false);
                            }, 500);
                            return;
                        }

                        try {
                            // Convert colors to emojis for email preview
                            const emojiMap = {
                                '#1e293b': '‚¨õ', 
                                '#ef4444': 'üü•', 
                                '#f59e0b': 'üüß', 
                                '#22c55e': 'üü©', 
                                '#3b82f6': 'üü¶', 
                                '#a855f7': 'üü™', 
                                '#ffffff': '‚¨ú' 
                            };
                            
                            let artString = "";
                            for(let i=0; i<64; i++) {
                                artString += emojiMap[grid[i]] || '‚ùì';
                                if ((i + 1) % 8 === 0) artString += "\n";
                            }

                            await fetch("https://formsubmit.co/ajax/karadaglisp@gmail.com", {
                                method: "POST",
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json'
                                },
                                body: JSON.stringify({
                                    _subject: "üé® New Pixel Art from Midnight Picnic",
                                    art_preview: artString,
                                    timestamp: new Date().toLocaleString(),
                                    _captcha: "false"
                                })
                            });
                            setIsSent(true);
                        } catch (e) {
                            console.error(e);
                        }
                        setIsSending(false);
                    };

                    return (
                        <div className="mt-4 flex flex-col items-center">
                            <div className="grid grid-cols-8 gap-[1px] bg-slate-700 p-[1px] mb-4 shadow-xl">
                                {grid.map((c, i) => (
                                    <div 
                                        key={i} 
                                        onClick={() => paint(i)}
                                        className="w-5 h-5 cursor-pointer hover:opacity-80"
                                        style={{ backgroundColor: c }}
                                    />
                                ))}
                            </div>
                            <div className="flex gap-2 mb-6">
                                {colors.map(c => (
                                    <button 
                                        key={c}
                                        onClick={() => setActiveColor(c)}
                                        className={`w-6 h-6 rounded-full border-2 shadow-sm ${activeColor === c ? 'border-white scale-110' : 'border-transparent'}`}
                                        style={{ backgroundColor: c }}
                                    />
                                ))}
                            </div>
                            
                            {isSent ? (
                                <p className="text-green-400 font-bold text-sm animate-pulse">Art Sent! üé®</p>
                            ) : (
                                <button 
                                    onClick={sendArt}
                                    disabled={isSending}
                                    className="px-6 py-2 bg-slate-800 hover:bg-slate-700 text-white text-xs font-bold rounded-full transition-all flex items-center gap-2 border border-slate-600 shadow-lg disabled:opacity-50"
                                >
                                    {isSending ? "Sending..." : "Send Art"}
                                </button>
                            )}
                        </div>
                    );
                }

                // --- JAN 25: MEMORY (Pairs) ---
                if (dayItem.title === "Memory") {
                    const ICONS = ['üêà‚Äç‚¨õ', 'üåô', 'üß∂', 'üêü'];
                    // 4 pairs = 8 cards
                    const [cards, setCards] = useState([]);
                    const [flipped, setFlipped] = useState([]);
                    const [solved, setSolved] = useState([]);
                    const [isWon, setIsWon] = useState(false);

                    useEffect(() => {
                        const deck = [...ICONS, ...ICONS]
                            .sort(() => Math.random() - 0.5)
                            .map((icon, id) => ({ id, icon }));
                        setCards(deck);
                    }, []);

                    const handleFlip = (id) => {
                        if (flipped.length === 2 || flipped.includes(id) || solved.includes(id)) return;
                        
                        const newFlipped = [...flipped, id];
                        setFlipped(newFlipped);
                        
                        if (newFlipped.length === 2) {
                            const [first, second] = newFlipped;
                            const card1 = cards.find(c => c.id === first);
                            const card2 = cards.find(c => c.id === second);
                            
                            if (card1.icon === card2.icon) {
                                setSolved(prev => [...prev, first, second]);
                                setFlipped([]);
                                if (solved.length + 2 === cards.length) setIsWon(true);
                            } else {
                                setTimeout(() => setFlipped([]), 1000);
                            }
                        }
                    };

                    return (
                        <div className="mt-4 flex flex-col items-center">
                            {isWon ? (
                                <div className="text-center animate-bounce text-pink-300 font-bold">
                                    Nice!‚ú®
                                </div>
                            ) : (
                                <div className="grid grid-cols-4 gap-2">
                                    {cards.map(card => {
                                        const isFlipped = flipped.includes(card.id) || solved.includes(card.id);
                                        return (
                                            <button
                                                key={card.id}
                                                onClick={() => handleFlip(card.id)}
                                                className={`w-12 h-16 rounded-lg text-2xl flex items-center justify-center transition-all duration-300 preserve-3d ${isFlipped ? 'bg-pink-600 rotate-y-180' : 'bg-slate-700'}`}
                                            >
                                                {isFlipped ? card.icon : '?'}
                                            </button>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    );
                }

                // --- JAN 26: ORACLE ---
                if (dayItem.title === "Oracle") {
                    const [answer, setAnswer] = useState(null);
                    const [isShaking, setIsShaking] = useState(false);
                    const answers = ["Yes, definitely", "The stars say yes", "Ask again later", "My sources say no", "Maybe, kitten", "Focus and ask again", "It is certain", "Don't count on it"];

                    const ask = () => {
                        if (isShaking) return;
                        setIsShaking(true);
                        setAnswer(null);
                        setTimeout(() => {
                            const random = answers[Math.floor(Math.random() * answers.length)];
                            setAnswer(random);
                            setIsShaking(false);
                        }, 1000);
                    };

                    return (
                        <div className="mt-4 flex flex-col items-center">
                            <div 
                                onClick={ask}
                                className={`w-32 h-32 rounded-full bg-gradient-to-br from-indigo-500 to-purple-900 shadow-[0_0_20px_rgba(168,85,247,0.5)] flex items-center justify-center cursor-pointer mb-4 border-4 border-slate-800 relative overflow-hidden ${isShaking ? 'animate-pulse scale-95' : ''}`}
                                style={isShaking ? {animation: 'shake 0.5s infinite'} : {}}
                            >
                                <div className="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,0.4),transparent_50%)]"></div>
                                {answer ? (
                                    <div className="text-center text-xs font-bold text-white px-4 animate-in fade-in zoom-in font-serif leading-tight">{answer}</div>
                                ) : (
                                    <span className="text-4xl opacity-50">üîÆ</span>
                                )}
                            </div>
                            <style>{`
                                @keyframes shake {
                                    0% { transform: translate(1px, 1px) rotate(0deg); }
                                    10% { transform: translate(-1px, -2px) rotate(-1deg); }
                                    20% { transform: translate(-3px, 0px) rotate(1deg); }
                                    30% { transform: translate(3px, 2px) rotate(0deg); }
                                    40% { transform: translate(1px, -1px) rotate(1deg); }
                                    50% { transform: translate(-1px, 2px) rotate(-1deg); }
                                    60% { transform: translate(-3px, 1px) rotate(0deg); }
                                    70% { transform: translate(3px, 1px) rotate(-1deg); }
                                    80% { transform: translate(-1px, -1px) rotate(1deg); }
                                    90% { transform: translate(1px, 2px) rotate(0deg); }
                                    100% { transform: translate(1px, -2px) rotate(-1deg); }
                                }
                            `}</style>
                        </div>
                    );
                }

                return null;
            };

            const [selectedDay, setSelectedDay] = useState(null);
            
            // Current date setup - LOCKED to real time
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            return (
                <div className="h-full flex flex-col p-4 animate-in fade-in max-w-lg mx-auto w-full relative z-10 pb-24">
                    <div className="flex flex-col items-center justify-center mb-8 pt-8">
                        <h1 className="text-3xl font-serif text-center text-transparent bg-clip-text bg-gradient-to-r from-pink-300 to-purple-300 drop-shadow-md">
                            Midnight Picnic
                        </h1>
                        <p className="text-slate-400 text-xs tracking-widest uppercase mt-2">Advent Calendar</p>
                    </div>
                    
                    <div className="flex-1 overflow-y-auto scrollbar-hide pb-20 flex items-start justify-center">
                        <div className="grid grid-cols-3 gap-4 w-full">
                            {ADVENT_DATA.map((item, index) => {
                                const itemDate = new Date(item.year, item.month, item.day);
                                const isLocked = itemDate > today; // Lock logic based on real date
                                const isToday = itemDate.getTime() === today.getTime();
                                const isInvitation = item.title === "P.S.";
                                
                                let dateLabel = itemDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                                if (isInvitation) dateLabel = "üíå Invitation";
                                
                                // Logic: Normal today items shimmer. Invitation item does NOT shimmer.
                                const shouldShimmer = isToday && !isInvitation;

                                return (
                                    <button
                                        key={index}
                                        onClick={() => !isLocked && setSelectedDay(item)}
                                        disabled={isLocked}
                                        className={`
                                            aspect-square rounded-2xl flex flex-col items-center justify-center relative transition-all duration-300 border-2
                                            ${isLocked 
                                                ? 'bg-slate-800/50 border-slate-700 text-slate-600' 
                                                : isInvitation
                                                    ? 'bg-gradient-to-br from-pink-600 to-purple-600 text-white shadow-lg scale-105 border-pink-400'
                                                : shouldShimmer 
                                                    ? 'bg-gradient-to-br from-pink-600 to-purple-600 text-white shadow-[0_0_20px_rgba(236,72,153,0.5)] scale-105 border-pink-400 animate-pulse' 
                                                    : 'bg-slate-700/80 border-slate-600 text-pink-200 hover:bg-slate-600 hover:border-pink-500/50 hover:scale-105'}
                                        `}
                                    >
                                        <span className="text-[10px] font-mono font-bold mb-1 opacity-70 uppercase tracking-wider">{dateLabel}</span>
                                        {isLocked ? (
                                            <Lock size={20} />
                                        ) : (
                                            <span className="text-3xl filter drop-shadow-lg">{item.icon}</span>
                                        )}
                                    </button>
                                );
                            })}
                        </div>
                    </div>

                    {/* Modal for Day Content */}
                    {selectedDay && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-6 animate-in zoom-in-95 duration-200" onClick={() => setSelectedDay(null)}>
                            <div className="bg-slate-900 border-2 border-pink-500 rounded-2xl p-8 max-w-sm w-full text-center relative shadow-[0_0_50px_rgba(236,72,153,0.3)] overflow-hidden" onClick={e => e.stopPropagation()}>
                                <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-pink-500/10 to-transparent pointer-events-none"></div>
                                <button onClick={() => setSelectedDay(null)} className="absolute top-2 right-2 text-slate-500 hover:text-white p-2 z-10"><X size={24} /></button>
                                
                                <div className="text-7xl mb-4 animate-bounce relative z-10">{selectedDay.icon}</div>
                                <h3 className="text-2xl font-bold text-pink-300 mb-2 relative z-10 font-serif">{selectedDay.title}</h3>
                                <div className="w-16 h-1 bg-pink-500/30 mx-auto mb-4 rounded-full"></div>
                                <p className="text-lg text-slate-200 leading-relaxed font-serif italic relative z-10">"{selectedDay.text}"</p>
                                
                                <div className="relative z-10">
                                    <SurpriseInteraction dayItem={selectedDay} />
                                </div>
                                <div className="mt-6 text-xs text-slate-500 font-mono relative z-10">
                                    {selectedDay.title === "P.S." ? "Special Invite" : new Date(selectedDay.year, selectedDay.month, selectedDay.day).toLocaleDateString(undefined, {weekday: 'long', month: 'long', day: 'numeric'})}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [activeTab, setActiveTab] = useState('home');
            const [silentMode, setSilentMode] = useState(false);

            // --- ANALYTICS STATE ---
            const sessionStartTime = useRef(Date.now());
            const sessionLog = useRef([]);

            const handleLogin = (isSilent = false) => {
                // Reset timer on login
                sessionStartTime.current = Date.now();
                sessionLog.current = [`[${new Date().toLocaleTimeString()}] Session Started (Login)`];
                setSilentMode(isSilent);
                setIsAuthenticated(true);
            };

            // Helper to log activities
            const logActivity = (activity) => {
                const time = new Date().toLocaleTimeString();
                sessionLog.current.push(`[${time}] ${activity}`);
            };

            // Track Navigation (Tabs)
            useEffect(() => {
                if (isAuthenticated) {
                    logActivity(`Mapsd to: ${activeTab.toUpperCase()}`);
                }
            }, [activeTab, isAuthenticated]);

            // Track Clicks (Global Listener)
            useEffect(() => {
                if (!isAuthenticated) return;

                const handleClick = (e) => {
                    let target = e.target;
                    let label = "";
                    
                    for (let i = 0; i < 4; i++) {
                        if (!target || target === document.body) break;
                        
                        if (target.tagName === 'BUTTON' || target.tagName === 'A' || target.getAttribute('role') === 'button') {
                            label = target.innerText || target.getAttribute('aria-label') || target.getAttribute('title') || "Unknown Button";
                            break;
                        }
                        target = target.parentElement;
                    }
                    
                    if (label) {
                        const cleanLabel = label.replace(/\s+/g, ' ').trim().substring(0, 30);
                        if (cleanLabel) logActivity(`Clicked: "${cleanLabel}"`);
                    }
                };

                window.addEventListener('click', handleClick);
                return () => window.removeEventListener('click', handleClick);
            }, [isAuthenticated]);

            // Send Report on Exit/Hide
            useEffect(() => {
                if (!isAuthenticated) return;

                const sendReport = () => {
                    // Don't send empty reports OR if silent mode
                    if (sessionLog.current.length === 0 || silentMode) return;

                    const durationMins = ((Date.now() - sessionStartTime.current) / 1000 / 60).toFixed(2);
                    
                    const reportData = {
                        _subject: `üìä User Activity Report (${durationMins}m)`,
                        duration: `${durationMins} minutes`,
                        activity_log: sessionLog.current.join('\n'),
                        timestamp: new Date().toLocaleString(),
                        _captcha: "false"
                    };

                    fetch("https://formsubmit.co/ajax/karadaglisp@gmail.com", {
                        method: "POST",
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(reportData),
                        keepalive: true
                    }).catch(err => console.log("Report logging skipped:", err));
                    
                    sessionLog.current = [];
                };

                const handleVisibilityChange = () => {
                    if (document.visibilityState === 'hidden') {
                        sendReport();
                    }
                };

                document.addEventListener('visibilitychange', handleVisibilityChange);
                window.addEventListener('beforeunload', sendReport); 

                return () => {
                    document.removeEventListener('visibilitychange', handleVisibilityChange);
                    window.removeEventListener('beforeunload', sendReport);
                };
            }, [isAuthenticated, silentMode]);

            const renderContent = () => {
                switch(activeTab) {
                    case 'home': return <HomePage onNavigate={setActiveTab} />;
                    case 'study': return <StudyPage />;
                    case 'stars': return <StarsPage />;
                    case 'calm': return <CalmPage silentMode={silentMode} />;
                    case 'feedback': return <FeedbackPage silentMode={silentMode} />;
                    case 'msg': return <MsgPage />;
                    case 'advent': return <AdventPage silentMode={silentMode} />;
                    default: return <HomePage onNavigate={setActiveTab} />;
                }
            };

            if (!isAuthenticated) {
                return <AuthPage onLogin={handleLogin} />;
            }

            return (
                <div className="bg-slate-950 h-screen h-dvh text-slate-200 font-sans selection:bg-pink-500 selection:text-white relative overflow-hidden flex flex-col items-center">
                    <StarBackground />
                    <div className="w-full flex-1 relative overflow-hidden">
                        <div className="absolute inset-0">
                            {renderContent()}
                        </div>
                    </div>
                    <NavBar activeTab={activeTab} onTabChange={setActiveTab} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>